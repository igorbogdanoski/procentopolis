{
  "rules": {
    ".read": false,
    ".write": false,

    "rooms": {
      "$roomId": {
        ".read": true,
        ".write": "auth !== null",

        "players": {
          "$playerId": {
            ".write": "auth !== null && (!data.exists() || data.child('uid').val() === auth.uid || root.child('rooms/' + $roomId + '/teacherUid').val() === auth.uid)",

            "name": {
              ".validate": "newData.isString() && newData.val().length >= 3 && newData.val().length <= 30"
            },
            "money": {
              ".validate": "newData.isNumber() && newData.val() >= -5000 && newData.val() <= 1000000"
            },
            "pos": {
              ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 19"
            },
            "role": {
              ".validate": "newData.val() === 'student' || newData.val() === 'teacher'"
            },
            "uid": {
              ".validate": "newData.isString() && newData.val() === auth.uid"
            }
          }
        },

        "gameBoard": {
          "$cellIndex": {
            ".write": "auth !== null",
            "owner": {
              ".validate": "newData.val() === null || (newData.isNumber() && newData.val() >= 0 && newData.val() <= 5)"
            },
            "buildings": {
              ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 5"
            }
          }
        },

        "tradeOffers": {
          "$offerId": {
            ".write": "auth !== null",
            ".validate": "newData.hasChildren(['from', 'to', 'propertyOffered', 'propertyWanted', 'status'])",
            "from": {
              ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 5"
            },
            "to": {
              ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 5"
            },
            "propertyOffered": {
              ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 19"
            },
            "propertyWanted": {
              ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 19"
            },
            "moneyOffered": {
              ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 10000"
            },
            "status": {
              ".validate": "newData.isString() && (newData.val() === 'pending' || newData.val() === 'accepted' || newData.val() === 'rejected')"
            }
          }
        },

        "currentPlayerIndex": {
          ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() < 6"
        },
        "turnStartTime": {
          ".validate": "newData.isNumber()"
        },
        "gameEndTime": {
          ".validate": "newData.isNumber()"
        },
        "remainingTime": {
          ".validate": "newData.isNumber() && newData.val() >= 0"
        }
      }
    }
  }
}
