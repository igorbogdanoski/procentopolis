{
  "rules": {
    ".read": false,
    ".write": false,

    "rooms": {
      "$roomId": {
        ".read": true,
        ".write": "auth !== null",

        "players": {
          "$playerId": {
            ".write": "auth !== null && (!data.exists() || data.child('uid').val() === auth.uid || root.child('rooms/' + $roomId + '/teacherUid').val() === auth.uid)",

            "name": {
              ".validate": "newData.isString() && newData.val().length >= 3 && newData.val().length <= 30"
            },
            "money": {
              ".validate": "newData.isNumber() && newData.val() >= -5000 && newData.val() <= 1000000"
            },
            "pos": {
              ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 19"
            },
            "role": {
              ".validate": "newData.val() === 'student' || newData.val() === 'teacher'"
            },
            "uid": {
              ".validate": "newData.isString() && newData.val() === auth.uid"
            }
          }
        },

        "gameBoard": {
          "$cellIndex": {
            ".write": "auth !== null",
            "owner": {
              ".validate": "newData.val() === null || (newData.isNumber() && newData.val() >= 0 && newData.val() <= 7)"
            },
            "buildings": {
              ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 5"
            }
          }
        },

        "tradeOffers": {
          "$offerId": {
            ".write": "auth !== null",
            ".validate": "newData.hasChildren(['from', 'to', 'propertyOffered', 'propertyWanted', 'status'])",
            "from": {
              ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 7"
            },
            "to": {
              ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 7"
            },
            "propertyOffered": {
              ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 19"
            },
            "propertyWanted": {
              ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 19"
            },
            "moneyOffered": {
              ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 10000"
            },
            "status": {
              ".validate": "newData.isString() && (newData.val() === 'pending' || newData.val() === 'accepted' || newData.val() === 'rejected')"
            }
          }
        },

        "currentPlayerIndex": {
          ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() < 8"
        },
        "turnStartTime": {
          ".validate": "newData.isNumber()"
        },
        "gameEndTime": {
          ".validate": "newData.isNumber()"
        },
        "remainingTime": {
          ".validate": "newData.isNumber() && newData.val() >= 0"
        },

        "auction": {
          ".write": "auth !== null",
          ".validate": "!newData.exists() || newData.hasChildren(['status','difficulty','category','sellerId','currentBid','leaderId','endTime','taskId','winnerId','resolved'])",
          "status":     { ".validate": "newData.val() === null || newData.val() === 'active' || newData.val() === 'resolved'" },
          "difficulty": { ".validate": "newData.isNumber() && newData.val() >= 1 && newData.val() <= 3" },
          "category":   { ".validate": "newData.isString() && newData.val().length >= 2 && newData.val().length <= 50" },
          "sellerId":   { ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 7" },
          "currentBid": { ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 50000" },
          "leaderId":   { ".validate": "newData.isNumber() && newData.val() >= -1 && newData.val() <= 7" },
          "endTime":    { ".validate": "newData.isNumber() && newData.val() > 0" },
          "taskId":     { ".validate": "newData.isNumber() && newData.val() >= 100" },
          "winnerId":   { ".validate": "newData.isNumber() && newData.val() >= -1 && newData.val() <= 7" },
          "resolved":   { ".validate": "newData.isBoolean()" }
        }
      }
    }
  }
}
