<!DOCTYPE html>
<html lang="mk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Percentopolis - –ü—Ä–æ—Ü–µ–Ω—Ç–û–ø–æ–ª–∏—Å</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- Login -->
<div id="login-overlay">
    <div class="login-container">
        <div class="login-info">
            <h2>üìú –£–ü–ê–¢–°–¢–í–û –ó–ê –ò–ì–†–ê–¢–ê</h2>
            <ul class="rules-list">
                <li class="rule-icon-money"><strong>–¶–µ–ª:</strong> –°–æ–±–µ—Ä–∏ –Ω–∞—ò–≥–æ–ª–µ–º–æ –±–æ–≥–∞—Ç—Å—Ç–≤–æ!</li>
                <li class="rule-icon-calc"><strong>–ö—É–ø—É–≤–∞—ö–µ:</strong> –†–µ—à–∏ –∑–∞–¥–∞—á–∞ –∑–∞ –¥–∞ –∫—É–ø–∏—à –∏–º–æ—Ç.</li>
                <li class="rule-icon-rent"><strong>–ö–∏—Ä–∏—ò–∞:</strong> –ü—Ä–µ—Å–º–µ—Ç–∞—ò —Ç–æ—á–Ω–æ –∏–ª–∏ –ø–ª–∞—Ç–∏ –î–£–ü–õ–û!</li>
            </ul>

            <div class="shop-preview">
                <h3>üõí –ü–†–û–î–ê–í–ù–ò–¶–ê –ó–ê –ú–û–å–ò</h3>
                <div class="shop-preview-grid">
                    <div class="shop-preview-item">‚öñÔ∏è –ê–¥–≤–æ–∫–∞—Ç</div>
                    <div class="shop-preview-item">üõ°Ô∏è –®—Ç–∏—Ç</div>
                    <div class="shop-preview-item">üöÄ –ù–∏—Ç—Ä–æ</div>
                    <div class="shop-preview-item">üïµÔ∏è –ò–Ω—Å–∞—ò–¥–µ—Ä</div>
                </div>
            </div>

            <div class="setup-sidebar" style="margin-top:25px; background: #f0f4f8; padding: 20px; border-radius: 20px; border: 1px solid #d1d9e6;">
                <label style="display:block; font-weight:800; margin-bottom:10px; color:#2c3e50; font-size:0.8rem;">üé≠ –¢–í–û–à–ê–¢–ê –£–õ–û–ì–ê:</label>
                <div class="role-selector" style="display:flex; gap:5px; margin-bottom:20px;">
                    <button id="role-student" class="role-btn active" onclick="setRole('student')">–£–ß–ï–ù–ò–ö</button>
                    <button id="role-teacher" class="role-btn" onclick="setRole('teacher')">–ù–ê–°–¢–ê–í–ù–ò–ö</button>
                </div>

                <div id="student-only-fields">
                    <label style="display:block; font-weight:800; margin-bottom:10px; color:#2c3e50; font-size:0.8rem;">üöÄ –ò–ó–ë–ï–†–ò –ü–ò–û–ù:</label>
                    <div id="token-selector" style="display:flex; gap:8px; justify-content:center; flex-wrap:wrap;">
                        <button onclick="selectToken('üöÄ', this)" class="token-choice active">üöÄ</button>
                        <button onclick="selectToken('üöó', this)" class="token-choice">üöó</button>
                        <button onclick="selectToken('üõ∏', this)" class="token-choice">üõ∏</button>
                        <button onclick="selectToken('ü§ñ', this)" class="token-choice">ü§ñ</button>
                        <button onclick="selectToken('ü¶Ñ', this)" class="token-choice">ü¶Ñ</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="login-form">
            <div class="portal-header">
                <h1>–ü–†–û–¶–ï–ù–¢–û–ü–û–õ–ò–°</h1>
                <p class="subtitle">–ú–ê–°–¢–ï–† –ü–û–†–¢–ê–õ</p>
                <div style="margin-top: 15px; font-size: 0.8rem; color: #64748b; font-weight: bold; background: #f1f5f9; display: inline-block; padding: 5px 15px; border-radius: 20px;">
                    –û–ø—Ç–∏–º–∞–ª–Ω–æ: 4-6 –∏–≥—Ä–∞—á–∏
                </div>
            </div>
            
            <div id="auth-section">
                <div class="input-group">
                    <label>üë§ –í–ê–®–ï–¢–û –ò–ú–ï:</label>
                    <input type="text" id="player-name-input" placeholder="–í–Ω–µ—Å–µ—Ç–µ –∏–º–µ..." autocomplete="off">
                    <div id="name-error" style="display:none; color:#ef4444; font-size:0.75rem; margin-top:5px; font-weight:600;"></div>
                </div>

                <div id="student-class-box">
                    <div class="input-group">
                        <label>üè´ –û–î–î–ï–õ–ï–ù–ò–ï:</label>
                        <select id="player-odd-input">
                            <option value="8-1">8-1</option>
                            <option value="8-2">8-2</option>
                            <option value="8-3">8-3</option>
                            <option value="8-4">8-4</option>
                        </select>
                    </div>
                </div>

                <div class="input-group room-box" id="student-room-box">
                    <label id="room-label">üè† –°–û–ë–ê:</label>
                    <div id="available-rooms-container" style="display:none; margin-bottom:10px; max-height:150px; overflow-y:auto; border:1px solid #ddd; border-radius:10px; padding:10px; background:white;">
                        <p style="font-size:0.7rem; color:#666; margin-bottom:5px;">–ò–ó–ë–ï–†–ò –ê–ö–¢–ò–í–ù–ê –°–û–ë–ê:</p>
                        <div id="available-rooms-list" style="display:flex; flex-wrap:wrap; gap:5px;"></div>
                    </div>
                    <input type="text" id="room-id-input" placeholder="–í–Ω–µ—Å–∏ –∏–ª–∏ –∏–∑–±–µ—Ä–∏ –∫–æ–¥..." autocomplete="off">
                    <div id="room-error" style="display:none; color:#ef4444; font-size:0.75rem; margin-top:5px; font-weight:600;"></div>
                </div>

                <button id="login-btn" disabled>üöÄ –í–õ–ï–ó–ò –í–û –ò–ì–†–ê</button>
                <button id="teacher-dashboard-btn" style="display:none; width:100%; padding:20px; font-size:1.2rem; background:#8b5cf6; color:white; border:none; border-radius:16px; cursor:pointer; font-weight:800; margin-top:10px; box-shadow:0 10px 20px rgba(139, 92, 246, 0.3);">üìä –û–¢–í–û–†–ò –ö–û–ù–¢–†–û–õ–ï–ù –ü–ê–ù–ï–õ</button>
            </div>
            <div id="lobby-section" style="display:none;">
                <div style="background: #1e40af; color: white; padding: 20px; border-radius: 20px; margin-bottom: 20px; text-align: center; box-shadow: 0 10px 25px rgba(30, 64, 175, 0.2);">
                    <p style="margin:0; font-size: 0.7rem; text-transform: uppercase; letter-spacing: 2px; font-weight: 800; opacity: 0.8;">–ü–†–ò–ö–õ–£–ß–ò –°–ï –°–û –ö–û–î:</p>
                    <h2 id="current-room-display" style="margin: 5px 0 0 0; font-size: 3rem; font-weight: 950; letter-spacing: 4px;">---</h2>
                </div>
                <div id="players-list" style="margin: 20px 0; text-align: left; background: #f8fafc; padding: 20px; border-radius: 15px; min-height: 120px; border: 1px solid #e2e8f0;">
                    <p style="font-weight: 800; color: #64748b; font-size: 0.8rem; margin-top: 0;">üë• –£–ß–ï–ù–ò–¶–ò –í–û –°–û–ë–ê–¢–ê:</p>
                    <ul id="lobby-players-ul" style="list-style: none; padding: 0; display: grid; grid-template-columns: 1fr 1fr; gap: 10px;"></ul>
                </div>
                
                <div id="teacher-lobby-controls" style="display:none; flex-direction:column; gap:10px;">
                    <button id="open-dash-direct-btn" onclick="openTeacherDash()" style="width: 100%; padding: 18px; background: #8b5cf6; color: white; border: none; border-radius: 16px; font-weight: 900; cursor: pointer; box-shadow: 0 10px 20px rgba(139, 92, 246, 0.2); font-size: 1rem; border: 2px solid rgba(255,255,255,0.2);">üìä –û–¢–í–û–†–ò –ö–û–ù–¢–†–û–õ–ï–ù –¶–ï–ù–¢–ê–†</button>
                    <button id="start-all-rooms-btn" onclick="startAllMyRooms()" style="width: 100%; padding: 15px; background: #3b82f6; color: white; border: none; border-radius: 16px; font-weight: 800; cursor: pointer; font-size: 0.9rem;">üöÄ –°–¢–ê–†–¢–£–í–ê–à –ì–ò –°–ò–¢–ï –°–û–ë–ò</button>
                    <button id="create-another-btn" onclick="location.reload()" style="width: 100%; padding: 12px; background: #f1f5f9; color: #475569; border: 1px solid #e2e8f0; border-radius: 16px; font-weight: 700; cursor: pointer; font-size: 0.8rem;">‚ûï –ö–†–ï–ò–†–ê–à –£–®–¢–ï –ï–î–ù–ê –°–û–ë–ê</button>
                </div>

                <button id="start-game-btn-multi" style="width: 100%; padding: 20px; background: #10b981; color: white; border: none; border-radius: 16px; font-weight: 900; cursor: pointer; box-shadow: 0 10px 20px rgba(16, 185, 129, 0.2); font-size: 1.1rem; margin-top: 10px;">–ó–ê–ü–û–ß–ù–ò –ò–ì–†–ê</button>
                <p style="font-size: 0.75rem; color: #94a3b8; margin-top: 15px; font-weight: 600;">–°–∞–º–æ –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫–æ—Ç –º–æ–∂–µ –¥–∞ —ò–∞ –∑–∞–ø–æ—á–Ω–µ –∏–≥—Ä–∞—Ç–∞.</p>
            </div>
            <button onclick="clearSave()" style="margin-top:10px; background:#e74c3c; border:none; color:white; padding:10px; border-radius:10px; cursor:pointer;">üóëÔ∏è –ò–ó–ë–†–ò–®–ò –ó–ê–ß–£–í–ê–ù–û</button>
        </div>
    </div>
</div>

<!-- Main Game -->
<div id="game-wrapper" class="blur-filter">
    <div id="game-board-container">
        <div id="board"></div>
        <div id="token-0" class="token">P1</div>
        <div id="token-1" class="token">P2</div>
        <div id="token-2" class="token">P3</div>
        <div id="token-3" class="token">P4</div>
        <div id="token-4" class="token">P5</div>
        <div id="token-5" class="token">P6</div>
    </div>
    <div id="controls-container">
        <div id="teacher-dash-btn-fixed" style="display:none; margin-bottom:10px;">
            <button onclick="openTeacherDash()" style="width:100%; padding:12px; background:#8b5cf6; color:white; border:none; border-radius:12px; font-weight:900; cursor:pointer; box-shadow:0 4px 12px rgba(139, 92, 246, 0.3); border:2px solid rgba(255,255,255,0.2);">üìä –ö–û–ù–¢–†–û–õ–ï–ù –ü–ê–ù–ï–õ –ó–ê –ù–ê–°–¢–ê–í–ù–ò–ö</button>
        </div>
        <div class="header-info">
            <div><h1 style="font-size:1.1rem; margin:0;">–ü—Ä–æ—Ü–µ–Ω—Ç–û–ø–æ–ª–∏—Å</h1><span id="player-display-name" style="font-size:0.8rem; font-weight:bold; color:#555;">–£—á–µ–Ω–∏–∫</span></div>
            <div style="display:flex; flex-direction:column; align-items:flex-end;">
                <div id="class-timer">40:00</div>
                <div id="turn-timer" style="font-size: 0.8rem; font-weight: bold; color: #3498db; margin-top: 5px;">–ü–æ—Ç–µ–≥: 30s</div>
            </div>
        </div>
        <div id="interaction-panel" style="display:flex; justify-content: space-around; padding: 5px; background: #f0f0f0; border-radius: 8px; margin-bottom: 10px;">
            <button onclick="sendEmoji('üòä')" style="background:none; border:none; font-size: 1.2rem; cursor:pointer;">üòä</button>
            <button onclick="sendEmoji('üòé')" style="background:none; border:none; font-size: 1.2rem; cursor:pointer;">üòé</button>
            <button onclick="sendEmoji('üî•')" style="background:none; border:none; font-size: 1.2rem; cursor:pointer;">üî•</button>
            <button onclick="sendEmoji('üëè')" style="background:none; border:none; font-size: 1.2rem; cursor:pointer;">üëè</button>
            <button onclick="sendEmoji('üéâ')" style="background:none; border:none; font-size: 1.2rem; cursor:pointer;">üéâ</button>
        </div>
        <div class="stats-panel" id="stats-panel-multi">
            <!-- Players stats will be injected here -->
        </div>
        <div id="game-log"></div>
        <div id="dice-container">
            <div class="dice" id="dice-visual">
                <div class="dice-face f1">1</div><div class="dice-face f2">2</div><div class="dice-face f3">3</div><div class="dice-face f4">4</div><div class="dice-face f5">5</div><div class="dice-face f6">6</div>
            </div>
        </div>
        <button id="roll-btn">üé≤ –§–†–õ–ò</button>
        <button id="shop-btn" onclick="openShop()">üõí –ü–†–û–î–ê–í–ù–ò–¶–ê</button>
        <button id="end-game-btn" onclick="triggerGameOver('–†–∞—á–µ–Ω –∫—Ä–∞—ò')" style="margin-top:5px; font-size:0.8rem; background:transparent; border:1px solid #ccc; color:#888;">üèÅ –ò–ó–í–ï–®–¢–ê–à</button>
    </div>
</div>

<!-- TEACHER DASHBOARD MODAL -->
<div id="teacher-modal" class="modal-overlay">
    <div class="modal-content teacher-modal-content">
        <!-- Sidebar for Room Selection -->
        <div id="teacher-sidebar">
            <div style="padding:25px; border-bottom:1px solid rgba(255,255,255,0.1);">
                <h3 style="margin:0; font-size:1.1rem; letter-spacing:1px;">üè´ –ú–û–ò –°–û–ë–ò</h3>
                <p style="margin:5px 0 0 0; font-size:0.7rem; color:#94a3b8;">–ò–∑–±–µ—Ä–∏ —Å–æ–±–∞ –∑–∞ –¥–µ—Ç–∞–ª–µ–Ω —É–≤–∏–¥</p>
            </div>
            <div id="dash-rooms-list" style="flex:1; overflow-y:auto; padding:15px;">
                <!-- Room buttons will be injected here -->
            </div>
            <div style="padding:20px; background:rgba(0,0,0,0.2); display:flex; flex-direction:column; gap:10px;">
                <button onclick="showCreateRoomInterface()" style="width:100%; padding:10px; background:#3b82f6; color:white; border:none; border-radius:8px; font-weight:bold; cursor:pointer;">+ –ö–†–ï–ò–†–ê–à –ù–û–í–ò</button>
                <button onclick="clearAllMyRooms()" style="width:100%; padding:8px; background:rgba(239, 68, 68, 0.2); color:#f87171; border:1px solid #ef4444; border-radius:8px; font-size:0.75rem; font-weight:bold; cursor:pointer;">üóëÔ∏è –ò–ó–ë–†–ò–®–ò –°–ò–¢–ï</button>
            </div>
        </div>

        <!-- Main Content Area -->
        <div style="flex:1; display:flex; flex-direction:column; background:#f8fafc;">
            <div class="modal-header" style="background: white; padding:25px 40px; border-bottom: 1px solid #e2e8f0; display:flex; justify-content:space-between; align-items:center;">
                <div style="display:flex; align-items:center; gap:15px;">
                    <button id="dash-back-to-list" style="display:none; background:#f1f5f9; border:none; padding:8px 15px; border-radius:8px; cursor:pointer; font-weight:bold;" onclick="toggleGridView(false)">‚¨ÖÔ∏è –ù–ê–ó–ê–î</button>
                    <div>
                        <h2 id="dash-active-room-title" style="margin:0; color:#1e293b; font-size:1.8rem; font-weight:900;">–ì–õ–ê–í–ï–ù –ü–ê–ù–ï–õ</h2>
                        <p id="dash-room-status" style="margin:0; color:#64748b; font-weight:500;">–ò–∑–±–µ—Ä–µ—Ç–µ —Å–æ–±–∞ –æ–¥ –ª–µ–≤–∞—Ç–∞ —Å—Ç—Ä–∞–Ω–∞</p>
                    </div>
                </div>
                <div style="display:flex; gap:10px;">
                    <button id="dash-download-btn" style="display:none; background:#34495e; color:white; border:none; border-radius:8px; padding:10px 20px; font-weight:bold; cursor:pointer;" onclick="downloadRoomReport()">üì• –ò–ó–í–ï–®–¢–ê–à</button>
                    <button id="dash-grid-view-btn" onclick="toggleGridView(true)" style="background:#8b5cf6; color:white; border:none; border-radius:8px; padding:10px 20px; font-weight:bold; cursor:pointer;">üì± –ü–†–ï–ì–õ–ï–î –ù–ê –°–ò–¢–ï</button>
                    <button id="dash-start-btn" style="display:none; background:#10b981; color:white; border:none; border-radius:8px; padding:10px 20px; font-weight:bold; cursor:pointer;">–°–¢–ê–†–¢–£–í–ê–à –°–û–ë–ê</button>
                    <button onclick="document.getElementById('teacher-modal').style.display='none'" style="background:#f1f5f9; border:none; border-radius:8px; padding:10px 20px; color:#475569; font-weight:bold; cursor:pointer;">–ó–ê–¢–í–û–†–ò</button>
                </div>
            </div>
            
            <div id="dash-main-scroll" style="padding:40px; overflow-y:auto; flex:1;">
                <!-- Grid View Container (Hidden by default) -->
                <div id="dash-grid-container" style="display:none; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap:25px;">
                    <!-- Room summary cards injected here -->
                </div>

                <!-- Single Room View Container -->
                <div id="dash-single-room-container">
                    <div style="display:grid; grid-template-columns: repeat(3, 1fr); gap:20px; margin-bottom:30px;">
                        <div style="background:white; padding:25px; border-radius:15px; box-shadow:0 4px 6px rgba(0,0,0,0.02); border:1px solid #e2e8f0;">
                            <p style="color:#64748b; font-size:0.75rem; text-transform:uppercase; font-weight:700; margin-bottom:10px;">üë• –£—á–µ–Ω–∏—Ü–∏</p>
                            <h3 id="dash-player-count" style="margin:0; font-size:2.2rem; color:#1e293b; font-weight:900;">0</h3>
                        </div>
                        <div style="background:white; padding:25px; border-radius:15px; box-shadow:0 4px 6px rgba(0,0,0,0.02); border:1px solid #e2e8f0;">
                            <p style="color:#64748b; font-size:0.75rem; text-transform:uppercase; font-weight:700; margin-bottom:10px;">‚úÖ –¢–æ—á–Ω–∏ –∑–∞–¥–∞—á–∏</p>
                            <h3 id="dash-total-correct" style="margin:0; font-size:2.2rem; color:#10b981; font-weight:900;">0</h3>
                        </div>
                        <div style="background:white; padding:25px; border-radius:15px; box-shadow:0 4px 6px rgba(0,0,0,0.02); border:1px solid #e2e8f0;">
                            <p style="color:#64748b; font-size:0.75rem; text-transform:uppercase; font-weight:700; margin-bottom:10px;">üìà –£—Å–ø–µ—à–Ω–æ—Å—Ç</p>
                            <h3 id="dash-avg-success" style="margin:0; font-size:2.2rem; color:#3b82f6; font-weight:900;">0%</h3>
                        </div>
                    </div>

                    <div style="background:white; border-radius:20px; box-shadow:0 10px 25px rgba(0,0,0,0.03); border:1px solid #e2e8f0; overflow:hidden;">
                        <table style="width:100%; border-collapse: collapse; text-align:left;">
                            <thead style="background:#f1f5f9;">
                                <tr>
                                    <th style="padding:20px; color:#475569; font-weight:700; font-size:0.8rem;">–£–ß–ï–ù–ò–ö</th>
                                    <th style="padding:20px; color:#475569; font-weight:700; font-size:0.8rem;">–ë–û–ì–ê–¢–°–¢–í–û</th>
                                    <th style="padding:20px; color:#475569; font-weight:700; font-size:0.8rem;">–¢–û–ß–ù–ò / –ì–†–ï–®–ù–ò</th>
                                    <th style="padding:20px; color:#475569; font-weight:700; font-size:0.8rem;">–ê–ö–¢–ò–í–ù–û–°–¢</th>
                                    <th style="padding:20px; color:#475569; font-weight:700; font-size:0.8rem;">–°–¢–ê–¢–£–°</th>
                                </tr>
                            </thead>
                            <tbody id="teacher-stats-tbody">
                                <!-- Player rows injected here -->
                            </tbody>
                        </table>
                        <div id="dash-empty-state" style="padding:100px; text-align:center; color:#94a3b8;">
                            <div style="font-size:4rem; margin-bottom:20px;">üïµÔ∏è‚Äç‚ôÇÔ∏è</div>
                            <h3>–ù–µ–º–∞ –∞–∫—Ç–∏–≤–Ω–∏ —É—á–µ–Ω–∏—Ü–∏ –≤–æ –æ–≤–∞–∞ —Å–æ–±–∞</h3>
                            <p>–ß–µ–∫–∞–º–µ —É—á–µ–Ω–∏—Ü–∏—Ç–µ –¥–∞ —Å–µ –ø—Ä–∏–∫–ª—É—á–∞—Ç —Å–æ –∫–æ–¥–æ—Ç.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Question Modal -->
<div id="question-modal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header" style="background:var(--primary-color); color:white; padding:15px; font-weight:bold; display:flex; justify-content:space-between;">
            <span id="modal-category">–ó–∞–¥–∞—á–∞</span>
            <span onclick="closeModal()" style="cursor:pointer; font-size:1.5rem;">&times;</span>
        </div>
        <div class="modal-body">
            <div class="question-side">
                <div id="question-text" style="font-size:1.3rem; font-weight:bold; margin-bottom:20px;">...</div>
                <div id="options-container"></div>
                <div id="input-answer-container">
                    <p style="font-size:0.9rem; color:#666; margin-bottom:5px;">–í–ø–∏—à–∏ –±—Ä–æ—ò (–∫–æ—Ä–∏—Å—Ç–∏ —Ç–æ—á–∫–∞ –∑–∞ –¥–µ—Ü–∏–º–∞–ª–∏):</p>
                    <input type="text" id="manual-answer-input" placeholder="–ø—Ä. 25.5">
                    <button id="submit-answer-btn">–ü–û–¢–í–†–î–ò –û–î–ì–û–í–û–†</button>
                </div>
                <button class="action-btn btn-hint" onclick="drawVisualHint()">üé® –í–ò–ó–£–ï–õ–ù–ê –ü–û–ú–û–® (HINT)</button>
                <div id="feedback-area" style="margin-top:20px; font-weight:bold;"></div>
            </div>
            <div class="whiteboard-side" id="canvas-parent">
                <canvas id="whiteboard"></canvas>
                <div class="canvas-tools" style="position:absolute; bottom:15px; left:50%; transform:translateX(-50%); background:white; padding:10px 20px; border-radius:30px; box-shadow:0 4px 15px rgba(0,0,0,0.2); z-index:100; display:flex; gap:15px; align-items:center;">
                    <div style="display:flex; gap:5px;">
                        <button onclick="changeColor('#000000')" style="width:25px; height:25px; border-radius:50%; background:black; border:2px solid #ddd; cursor:pointer;"></button>
                        <button onclick="changeColor('#e74c3c')" style="width:25px; height:25px; border-radius:50%; background:#e74c3c; border:2px solid #ddd; cursor:pointer;"></button>
                        <button onclick="changeColor('#3498db')" style="width:25px; height:25px; border-radius:50%; background:#3498db; border:2px solid #ddd; cursor:pointer;"></button>
                        <button onclick="changeColor('#2ecc71')" style="width:25px; height:25px; border-radius:50%; background:#2ecc71; border:2px solid #ddd; cursor:pointer;"></button>
                    </div>
                    <div style="height:20px; width:1px; background:#ddd;"></div>
                    <input type="range" id="pen-width" min="1" max="10" value="3" style="width:80px;">
                    <div style="height:20px; width:1px; background:#ddd;"></div>
                    <button onclick="clearCanvas()" style="background:none; border:none; font-size:1.2rem; cursor:pointer;" title="–ò–∑–±—Ä–∏—à–∏ —Å–µ">üóëÔ∏è</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- SHOP MODAL -->
<div id="shop-modal" class="modal-overlay">
    <div class="modal-mini" style="width:600px; display:block; position:relative; top:auto; left:auto; transform:none; animation:none;">
        <h2>üõí –ü–†–û–î–ê–í–ù–ò–¶–ê –ó–ê –ú–û–å–ò</h2>
        <p>–ò—Å–∫–æ—Ä–∏—Å—Ç–∏ –≥–∏ –ø–∞—Ä–∏—Ç–µ –∑–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—ò–∞!</p>
        <div class="shop-grid">
            <div class="shop-item" onclick="buyItem('lawyer', 300)"><div class="shop-icon">‚öñÔ∏è</div><h3>–ê–¥–≤–æ–∫–∞—Ç</h3><p>–¢–µ —à—Ç–∏—Ç–∏ –æ–¥ —Å–ª–µ–¥–Ω–∞—Ç–∞ –¥–∞–Ω–æ—á–Ω–∞ –∏–Ω—Å–ø–µ–∫—Ü–∏—ò–∞.</p><div class="shop-price">300–¥</div></div>
            <div class="shop-item" onclick="buyItem('shield', 250)"><div class="shop-icon">üõ°Ô∏è</div><h3>–ó–ª–∞—Ç–µ–Ω –®—Ç–∏—Ç</h3><p>–ï–¥–Ω–∞—à –Ω–µ –ø–ª–∞—ú–∞—à –∫–∏—Ä–∏—ò–∞ –∫–∞—ò –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫.</p><div class="shop-price">250–¥</div></div>
            <div class="shop-item" onclick="buyItem('nitro', 150)"><div class="shop-icon">üöÄ</div><h3>–ù–∏—Ç—Ä–æ –ö–æ—Ü–∫–∞</h3><p>–°–ª–µ–¥–Ω–æ—Ç–æ —Ñ—Ä–ª–∞—ö–µ –µ —Å–æ –¥—É–ø–ª–∞ –≤—Ä–µ–¥–Ω–æ—Å—Ç.</p><div class="shop-price">150–¥</div></div>
            <div class="shop-item" onclick="buyItem('bribe', 500)"><div class="shop-icon">üïµÔ∏è</div><h3>–ò–Ω—Å–∞—ò–¥–µ—Ä</h3><p>–ó–µ–º–∏ –≥–æ —Å–ª–µ–¥–Ω–∏–æ—Ç –∏–º–æ—Ç –Ω–∞ –∫–æ—ò —ú–µ –∑–∞—Å—Ç–∞–Ω–µ—à –∑–∞ 1 –¥–µ–Ω–∞—Ä.</p><div class="shop-price">500–¥</div></div>
        </div>
        <button class="action-btn btn-pass" style="margin-top:20px; width:100%;" onclick="document.getElementById('shop-modal').style.display='none'">–ó–ê–¢–í–û–†–ò</button>
    </div>
</div>

<!-- NEW: Property Card Overlay -->
<div id="card-overlay" class="modal-overlay"></div>

<!-- Game Over -->
<div id="game-over-overlay">
    <div class="modal-mini" style="width:600px; display:block; position:relative; top:auto; left:auto; transform:none; animation:none;">
        <h2>üèÜ –ö–†–ê–à –ù–ê –ò–ì–†–ê–¢–ê</h2>
        <p id="report-text" style="text-align:left; line-height:1.6; font-size:0.9rem; max-height: 300px; overflow-y:auto;"></p>
        <div id="qrcode" style="margin:15px auto; display:flex; justify-content:center;"></div>
        <button onclick="clearSave(); location.reload()" style="padding:10px 20px; background:var(--primary-color); color:white; border:none; border-radius:8px; cursor:pointer; margin-top:10px;">–ù–û–í–ê –ò–ì–†–ê</button>
    </div>
</div>

<!-- PHASE 2: Onboarding Tutorial -->
<div id="tutorial-overlay">
    <div class="tutorial-modal">
        <div class="tutorial-header">
            <div class="tutorial-icon" id="tutorial-icon">üéÆ</div>
            <h2 class="tutorial-title" id="tutorial-title">–î–æ–±—Ä–µ–¥–æ—ò–¥–µ!</h2>
            <p class="tutorial-subtitle" id="tutorial-subtitle">–ê—ò–¥–µ –¥–∞ –Ω–∞—É—á–∏–º–µ –∫–∞–∫–æ —Å–µ –∏–≥—Ä–∞</p>
        </div>
        <div class="tutorial-content" id="tutorial-content">
            <!-- Content will be dynamically injected -->
        </div>
        <div class="tutorial-footer">
            <div class="tutorial-progress" id="tutorial-progress">–ß–µ–∫–æ—Ä 1 –æ–¥ 7</div>
            <div class="tutorial-nav">
                <button class="tutorial-btn tutorial-btn-skip" onclick="skipTutorial()">–ü—Ä–µ—Å–∫–æ–∫–Ω–∏</button>
                <button class="tutorial-btn tutorial-btn-next" id="tutorial-next-btn" onclick="nextTutorialStep()">–°–ª–µ–¥–Ω–æ ‚Üí</button>
            </div>
        </div>
    </div>
</div>

<!-- PHASE 2: Confetti Container -->
<div id="confetti-container" class="confetti-container"></div>

<script src="script.js"></script>
</body>
</html>