<!DOCTYPE html>
<html lang="mk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Percentopolis - –ü—Ä–æ—Ü–µ–Ω—Ç–û–ø–æ–ª–∏—Å</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- Login -->
<div id="login-overlay">
    <div class="login-container">
        <div class="login-info">
            <h2>üìú –£–ü–ê–¢–°–¢–í–û –ó–ê –ò–ì–†–ê–¢–ê</h2>
            <ul class="rules-list">
                <li class="rule-icon-money"><strong>–¶–µ–ª:</strong> –°–æ–±–µ—Ä–∏ –Ω–∞—ò–≥–æ–ª–µ–º–æ –±–æ–≥–∞—Ç—Å—Ç–≤–æ!</li>
                <li class="rule-icon-calc"><strong>–ö—É–ø—É–≤–∞—ö–µ:</strong> –†–µ—à–∏ –∑–∞–¥–∞—á–∞ –∑–∞ –¥–∞ –∫—É–ø–∏—à –∏–º–æ—Ç.</li>
                <li class="rule-icon-rent"><strong>–ö–∏—Ä–∏—ò–∞:</strong> –ü—Ä–µ—Å–º–µ—Ç–∞—ò —Ç–æ—á–Ω–æ –∏–ª–∏ –ø–ª–∞—Ç–∏ –î–£–ü–õ–û!</li>
            </ul>

            <div class="shop-preview">
                <h3>üõí –ü–†–û–î–ê–í–ù–ò–¶–ê –ó–ê –ú–û–å–ò</h3>
                <div class="shop-preview-grid">
                    <div class="shop-preview-item">‚öñÔ∏è –ê–¥–≤–æ–∫–∞—Ç</div>
                    <div class="shop-preview-item">üõ°Ô∏è –®—Ç–∏—Ç</div>
                    <div class="shop-preview-item">üöÄ –ù–∏—Ç—Ä–æ</div>
                    <div class="shop-preview-item">üïµÔ∏è –ò–Ω—Å–∞—ò–¥–µ—Ä</div>
                </div>
            </div>

            <div class="setup-sidebar" style="margin-top:25px; background: #f0f4f8; padding: 20px; border-radius: 20px; border: 1px solid #d1d9e6;">
                <label style="display:block; font-weight:800; margin-bottom:10px; color:#2c3e50; font-size:0.8rem;">üé≠ –¢–í–û–à–ê–¢–ê –£–õ–û–ì–ê:</label>
                <div class="role-selector" style="display:flex; gap:5px; margin-bottom:20px;">
                    <button id="role-student" class="role-btn active" onclick="setRole('student')">–£–ß–ï–ù–ò–ö</button>
                    <button id="role-teacher" class="role-btn" onclick="setRole('teacher')">–ù–ê–°–¢–ê–í–ù–ò–ö</button>
                </div>

                <div id="student-only-fields">
                    <label style="display:block; font-weight:800; margin-bottom:10px; color:#2c3e50; font-size:0.8rem;">üöÄ –ò–ó–ë–ï–†–ò –ü–ò–û–ù:</label>
                    <div id="token-selector" style="display:flex; gap:8px; justify-content:center; flex-wrap:wrap;">
                        <button onclick="selectToken('üöÄ', this)" class="token-choice active">üöÄ</button>
                        <button onclick="selectToken('üöó', this)" class="token-choice">üöó</button>
                        <button onclick="selectToken('üõ∏', this)" class="token-choice">üõ∏</button>
                        <button onclick="selectToken('ü§ñ', this)" class="token-choice">ü§ñ</button>
                        <button onclick="selectToken('ü¶Ñ', this)" class="token-choice">ü¶Ñ</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="login-form">
            <div class="portal-header">
                <h1>–ü–†–û–¶–ï–ù–¢–û–ü–û–õ–ò–°</h1>
                <p class="subtitle">–ú–ê–°–¢–ï–† –ü–û–†–¢–ê–õ</p>
                <div style="margin-top: 15px; font-size: 0.8rem; color: #64748b; font-weight: bold; background: #f1f5f9; display: inline-block; padding: 5px 15px; border-radius: 20px;">
                    –û–ø—Ç–∏–º–∞–ª–Ω–æ: 4-6 –∏–≥—Ä–∞—á–∏
                </div>
            </div>
            
            <div id="auth-section">
                <div class="input-group">
                    <label>üë§ –í–ê–®–ï–¢–û –ò–ú–ï:</label>
                    <input type="text" id="player-name-input" placeholder="–í–Ω–µ—Å–µ—Ç–µ –∏–º–µ..." autocomplete="off">
                </div>

                <div id="student-class-box">
                    <div class="input-group">
                        <label>üè´ –û–î–î–ï–õ–ï–ù–ò–ï:</label>
                        <select id="player-odd-input">
                            <option value="8-1">8-1</option>
                            <option value="8-2">8-2</option>
                            <option value="8-3">8-3</option>
                            <option value="8-4">8-4</option>
                        </select>
                    </div>
                </div>

                <div class="input-group room-box">
                    <label id="room-label">üè† –°–û–ë–ê:</label>
                    <input type="text" id="room-id-input" placeholder="–ö–æ–¥ –Ω–∞ —Å–æ–±–∞" autocomplete="off">
                    <div id="teacher-rooms-list"></div>
                    <div id="teacher-settings" style="display:none; margin-top:15px; border-top:1px solid #ddd; padding-top:10px;">
                        <label>üìä –¢–ï–ñ–ò–ù–ê:</label>
                        <select id="room-difficulty-select" style="margin-bottom:15px;">
                            <option value="easy">–õ–ï–°–ù–û</option>
                            <option value="standard" selected>–°–¢–ê–ù–î–ê–†–î–ù–û</option>
                            <option value="hard">–ù–ê–ü–†–ï–î–ù–û</option>
                        </select>
                        
                        <div style="background:#f8fafc; padding:10px; border-radius:10px; border:1px solid #e2e8f0; margin-top:10px;">
                            <label style="font-size:0.7rem;">‚ö° –ë–†–ó–û –ö–†–ï–ò–†–ê–ä–ï –ü–û–í–ï–å–ï –°–û–ë–ò:</label>
                            <div style="display:flex; gap:5px; margin-top:5px;">
                                <input type="number" id="multi-room-count" value="4" min="1" max="10" style="width:60px; padding:5px;">
                                <button onclick="createMultipleRooms()" style="flex:1; background:#3b82f6; color:white; border:none; border-radius:8px; font-size:0.7rem; cursor:pointer;">–ö–†–ï–ò–†–ê–à –°–ï–ì–ê</button>
                            </div>
                        </div>
                    </div>
                </div>

                <button id="login-btn" disabled>üöÄ –í–õ–ï–ó–ò –í–û –ò–ì–†–ê</button>
            </div>
            <div id="lobby-section" style="display:none;">
                <div style="background: var(--primary-color); color: white; padding: 20px; border-radius: 15px; margin-bottom: 20px; text-align: center;">
                    <p style="margin:0; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px;">–ö–æ–¥ –∑–∞ –ø—Ä–∏–∫–ª—É—á—É–≤–∞—ö–µ:</p>
                    <h2 id="current-room-display" style="margin: 5px 0 0 0; font-size: 2.5rem; font-weight: 900; letter-spacing: 2px;">---</h2>
                </div>
                <div id="players-list" style="margin: 20px 0; text-align: left; background: #f8f9fa; padding: 15px; border-radius: 10px; min-height: 100px;">
                    <p>–ò–≥—Ä–∞—á–∏ –≤–æ —Å–æ–±–∞—Ç–∞:</p>
                    <ul id="lobby-players-ul" style="list-style: none; padding: 0;"></ul>
                </div>
                <button id="start-game-btn-multi" style="width: 100%; padding: 15px; background: #27ae60; color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer;">–ó–ê–ü–û–ß–ù–ò –ò–ì–†–ê</button>
                <button id="start-all-rooms-btn" onclick="startAllMyRooms()" style="display:none; margin-top:10px; width: 100%; padding: 15px; background: #3b82f6; color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer;">üöÄ –°–¢–ê–†–¢–£–í–ê–à –ì–ò –°–ò–¢–ï –ú–û–ò –°–û–ë–ò</button>
                <button id="create-another-btn" onclick="location.reload()" style="display:none; margin-top:10px; width: 100%; padding: 12px; background: #34495e; color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer;">‚ûï –ö–†–ï–ò–†–ê–à –£–®–¢–ï –ï–î–ù–ê –°–û–ë–ê</button>
                <p style="font-size: 0.8rem; color: #666; margin-top: 10px;">–°–∞–º–æ –∫—Ä–µ–∞—Ç–æ—Ä–æ—Ç –Ω–∞ —Å–æ–±–∞—Ç–∞ –º–æ–∂–µ –¥–∞ —ò–∞ –∑–∞–ø–æ—á–Ω–µ –∏–≥—Ä–∞—Ç–∞.</p>
            </div>
            <button onclick="clearSave()" style="margin-top:10px; background:#e74c3c; border:none; color:white; padding:10px; border-radius:10px; cursor:pointer;">üóëÔ∏è –ò–ó–ë–†–ò–®–ò –ó–ê–ß–£–í–ê–ù–û</button>
        </div>
    </div>
</div>

<!-- Main Game -->
<div id="game-wrapper" class="blur-filter">
    <div id="game-board-container">
        <div id="board"></div>
        <div id="token-0" class="token">P1</div>
        <div id="token-1" class="token">P2</div>
        <div id="token-2" class="token">P3</div>
        <div id="token-3" class="token">P4</div>
        <div id="token-4" class="token">P5</div>
        <div id="token-5" class="token">P6</div>
    </div>
    <div id="controls-container">
        <div class="header-info">
            <div><h1 style="font-size:1.1rem; margin:0;">–ü—Ä–æ—Ü–µ–Ω—Ç–û–ø–æ–ª–∏—Å</h1><span id="player-display-name" style="font-size:0.8rem; font-weight:bold; color:#555;">–£—á–µ–Ω–∏–∫</span></div>
            <div style="display:flex; flex-direction:column; align-items:flex-end;">
                <div id="class-timer">40:00</div>
                <div id="turn-timer" style="font-size: 0.8rem; font-weight: bold; color: #3498db; margin-top: 5px;">–ü–æ—Ç–µ–≥: 30s</div>
            </div>
        </div>
        <div id="interaction-panel" style="display:flex; justify-content: space-around; padding: 5px; background: #f0f0f0; border-radius: 8px; margin-bottom: 10px;">
            <button onclick="sendEmoji('üòä')" style="background:none; border:none; font-size: 1.2rem; cursor:pointer;">üòä</button>
            <button onclick="sendEmoji('üòé')" style="background:none; border:none; font-size: 1.2rem; cursor:pointer;">üòé</button>
            <button onclick="sendEmoji('üî•')" style="background:none; border:none; font-size: 1.2rem; cursor:pointer;">üî•</button>
            <button onclick="sendEmoji('üëè')" style="background:none; border:none; font-size: 1.2rem; cursor:pointer;">üëè</button>
            <button onclick="sendEmoji('üéâ')" style="background:none; border:none; font-size: 1.2rem; cursor:pointer;">üéâ</button>
        </div>
        <div class="stats-panel" id="stats-panel-multi">
            <!-- Players stats will be injected here -->
        </div>
        <div id="game-log"></div>
        <div id="dice-container">
            <div class="dice" id="dice-visual">
                <div class="dice-face f1">1</div><div class="dice-face f2">2</div><div class="dice-face f3">3</div><div class="dice-face f4">4</div><div class="dice-face f5">5</div><div class="dice-face f6">6</div>
            </div>
        </div>
        <button id="roll-btn">üé≤ –§–†–õ–ò</button>
        <button id="shop-btn" onclick="openShop()">üõí –ü–†–û–î–ê–í–ù–ò–¶–ê</button>
        <button id="teacher-dash-btn" style="display:none; margin-top:5px; background:#2c3e50; color:white; border:none; padding:8px; border-radius:10px; cursor:pointer;" onclick="openTeacherDash()">üìä –ü–ê–ù–ï–õ –ó–ê –ù–ê–°–¢–ê–í–ù–ò–ö</button>
        <button id="end-game-btn" onclick="triggerGameOver('–†–∞—á–µ–Ω –∫—Ä–∞—ò')" style="margin-top:5px; font-size:0.8rem; background:transparent; border:1px solid #ccc; color:#888;">üèÅ –ò–ó–í–ï–®–¢–ê–à</button>
    </div>
</div>

<!-- TEACHER DASHBOARD MODAL -->
<div id="teacher-modal" class="modal-overlay">
    <div class="modal-content" style="width:1200px; height:800px; padding:0;">
        <div class="modal-header" style="background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); padding:30px; border-bottom: 1px solid rgba(255,255,255,0.1);">
            <div style="display:flex; align-items:center; justify-content:space-between; width:100%;">
                <div style="display:flex; align-items:center; gap:20px;">
                    <div style="font-size:2.5rem; filter: drop-shadow(0 0 10px rgba(59,130,246,0.5));">üìä</div>
                    <div>
                        <h2 style="margin:0; color:white; font-size:2rem; font-weight:900; letter-spacing:-1px;">–ö–û–ù–¢–†–û–õ–ï–ù –ü–ê–ù–ï–õ –ó–ê –ù–ê–°–¢–ê–í–ù–ò–ö</h2>
                        <p style="margin:0; color:#94a3b8; font-size:1rem; font-weight:500;">–°–ª–µ–¥–µ—ö–µ –Ω–∞ –Ω–∞–ø—Ä–µ–¥–æ–∫–æ—Ç –Ω–∞ –æ–¥–¥–µ–ª–µ–Ω–∏–µ—Ç–æ –≤–æ —Ä–µ–∞–ª–Ω–æ –≤—Ä–µ–º–µ</p>
                    </div>
                </div>
                <button onclick="document.getElementById('teacher-modal').style.display='none'" style="background:rgba(255,255,255,0.1); border:none; border-radius:12px; padding:10px 20px; color:white; font-weight:bold; cursor:pointer; transition:0.2s;">–ó–ê–¢–í–û–†–ò</button>
            </div>
        </div>
        <div style="padding:40px; overflow-y:auto; flex:1; background:#f8fafc;">
            <div style="display:grid; grid-template-columns: repeat(3, 1fr); gap:20px; margin-bottom:30px;">
                <div style="background:white; padding:20px; border-radius:15px; box-shadow:0 4px 6px rgba(0,0,0,0.05); border:1px solid #e2e8f0;">
                    <p style="color:#64748b; font-size:0.8rem; text-transform:uppercase; margin-bottom:5px;">–ê–∫—Ç–∏–≤–Ω–∏ –∏–≥—Ä–∞—á–∏</p>
                    <h3 id="dash-player-count" style="margin:0; font-size:2rem; color:#1e293b;">0</h3>
                </div>
                <div style="background:white; padding:20px; border-radius:15px; box-shadow:0 4px 6px rgba(0,0,0,0.05); border:1px solid #e2e8f0;">
                    <p style="color:#64748b; font-size:0.8rem; text-transform:uppercase; margin-bottom:5px;">–í–∫—É–ø–Ω–æ —Ç–æ—á–Ω–∏</p>
                    <h3 id="dash-total-correct" style="margin:0; font-size:2rem; color:#22c55e;">0</h3>
                </div>
                <div style="background:white; padding:20px; border-radius:15px; box-shadow:0 4px 6px rgba(0,0,0,0.05); border:1px solid #e2e8f0;">
                    <p style="color:#64748b; font-size:0.8rem; text-transform:uppercase; margin-bottom:5px;">–ü—Ä–æ—Å–µ—á–µ–Ω —É—Å–ø–µ—Ö</p>
                    <h3 id="dash-avg-success" style="margin:0; font-size:2rem; color:#3b82f6;">0%</h3>
                </div>
            </div>
            <div style="background:white; border-radius:20px; box-shadow:0 10px 15px rgba(0,0,0,0.05); border:1px solid #e2e8f0; overflow:hidden;">
                <table style="width:100%; border-collapse: collapse; text-align:left;">
                    <thead style="background:#f1f5f9;">
                        <tr>
                            <th style="padding:20px; color:#475569; font-weight:600;">–£–ß–ï–ù–ò–ö</th>
                            <th style="padding:20px; color:#475569; font-weight:600;">–ë–û–ì–ê–¢–°–¢–í–û</th>
                            <th style="padding:20px; color:#475569; font-weight:600;">–¢–û–ß–ù–ò/–ì–†–ï–®–ù–ò</th>
                            <th style="padding:20px; color:#475569; font-weight:600;">–ê–ö–¢–ò–í–ù–û–°–¢</th>
                            <th style="padding:20px; color:#475569; font-weight:600;">–°–¢–ê–¢–£–°</th>
                        </tr>
                    </thead>
                    <tbody id="teacher-stats-tbody"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Question Modal -->
<div id="question-modal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header" style="background:var(--primary-color); color:white; padding:15px; font-weight:bold; display:flex; justify-content:space-between;">
            <span id="modal-category">–ó–∞–¥–∞—á–∞</span>
            <span onclick="closeModal()" style="cursor:pointer; font-size:1.5rem;">&times;</span>
        </div>
        <div class="modal-body">
            <div class="question-side">
                <div id="question-text" style="font-size:1.3rem; font-weight:bold; margin-bottom:20px;">...</div>
                <div id="options-container"></div>
                <div id="input-answer-container">
                    <p style="font-size:0.9rem; color:#666; margin-bottom:5px;">–í–ø–∏—à–∏ –±—Ä–æ—ò (–∫–æ—Ä–∏—Å—Ç–∏ —Ç–æ—á–∫–∞ –∑–∞ –¥–µ—Ü–∏–º–∞–ª–∏):</p>
                    <input type="text" id="manual-answer-input" placeholder="–ø—Ä. 25.5">
                    <button id="submit-answer-btn">–ü–û–¢–í–†–î–ò –û–î–ì–û–í–û–†</button>
                </div>
                <button class="action-btn btn-hint" onclick="drawVisualHint()">üé® –í–ò–ó–£–ï–õ–ù–ê –ü–û–ú–û–® (HINT)</button>
                <div id="feedback-area" style="margin-top:20px; font-weight:bold;"></div>
            </div>
            <div class="whiteboard-side" id="canvas-parent">
                <canvas id="whiteboard"></canvas>
                <div class="canvas-tools" style="position:absolute; bottom:15px; left:50%; transform:translateX(-50%); background:white; padding:10px 20px; border-radius:30px; box-shadow:0 4px 15px rgba(0,0,0,0.2); z-index:100; display:flex; gap:15px; align-items:center;">
                    <div style="display:flex; gap:5px;">
                        <button onclick="changeColor('#000000')" style="width:25px; height:25px; border-radius:50%; background:black; border:2px solid #ddd; cursor:pointer;"></button>
                        <button onclick="changeColor('#e74c3c')" style="width:25px; height:25px; border-radius:50%; background:#e74c3c; border:2px solid #ddd; cursor:pointer;"></button>
                        <button onclick="changeColor('#3498db')" style="width:25px; height:25px; border-radius:50%; background:#3498db; border:2px solid #ddd; cursor:pointer;"></button>
                        <button onclick="changeColor('#2ecc71')" style="width:25px; height:25px; border-radius:50%; background:#2ecc71; border:2px solid #ddd; cursor:pointer;"></button>
                    </div>
                    <div style="height:20px; width:1px; background:#ddd;"></div>
                    <input type="range" id="pen-width" min="1" max="10" value="3" style="width:80px;">
                    <div style="height:20px; width:1px; background:#ddd;"></div>
                    <button onclick="clearCanvas()" style="background:none; border:none; font-size:1.2rem; cursor:pointer;" title="–ò–∑–±—Ä–∏—à–∏ —Å–µ">üóëÔ∏è</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- SHOP MODAL -->
<div id="shop-modal" class="modal-overlay">
    <div class="modal-mini" style="width:600px; display:block; position:relative; top:auto; left:auto; transform:none; animation:none;">
        <h2>üõí –ü–†–û–î–ê–í–ù–ò–¶–ê –ó–ê –ú–û–å–ò</h2>
        <p>–ò—Å–∫–æ—Ä–∏—Å—Ç–∏ –≥–∏ –ø–∞—Ä–∏—Ç–µ –∑–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—ò–∞!</p>
        <div class="shop-grid">
            <div class="shop-item" onclick="buyItem('lawyer', 300)"><div class="shop-icon">‚öñÔ∏è</div><h3>–ê–¥–≤–æ–∫–∞—Ç</h3><p>–¢–µ —à—Ç–∏—Ç–∏ –æ–¥ —Å–ª–µ–¥–Ω–∞—Ç–∞ –¥–∞–Ω–æ—á–Ω–∞ –∏–Ω—Å–ø–µ–∫—Ü–∏—ò–∞.</p><div class="shop-price">300–¥</div></div>
            <div class="shop-item" onclick="buyItem('shield', 250)"><div class="shop-icon">üõ°Ô∏è</div><h3>–ó–ª–∞—Ç–µ–Ω –®—Ç–∏—Ç</h3><p>–ï–¥–Ω–∞—à –Ω–µ –ø–ª–∞—ú–∞—à –∫–∏—Ä–∏—ò–∞ –∫–∞—ò –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫.</p><div class="shop-price">250–¥</div></div>
            <div class="shop-item" onclick="buyItem('nitro', 150)"><div class="shop-icon">üöÄ</div><h3>–ù–∏—Ç—Ä–æ –ö–æ—Ü–∫–∞</h3><p>–°–ª–µ–¥–Ω–æ—Ç–æ —Ñ—Ä–ª–∞—ö–µ –µ —Å–æ –¥—É–ø–ª–∞ –≤—Ä–µ–¥–Ω–æ—Å—Ç.</p><div class="shop-price">150–¥</div></div>
            <div class="shop-item" onclick="buyItem('bribe', 500)"><div class="shop-icon">üïµÔ∏è</div><h3>–ò–Ω—Å–∞—ò–¥–µ—Ä</h3><p>–ó–µ–º–∏ –≥–æ —Å–ª–µ–¥–Ω–∏–æ—Ç –∏–º–æ—Ç –Ω–∞ –∫–æ—ò —ú–µ –∑–∞—Å—Ç–∞–Ω–µ—à –∑–∞ 1 –¥–µ–Ω–∞—Ä.</p><div class="shop-price">500–¥</div></div>
        </div>
        <button class="action-btn btn-pass" style="margin-top:20px; width:100%;" onclick="document.getElementById('shop-modal').style.display='none'">–ó–ê–¢–í–û–†–ò</button>
    </div>
</div>

<!-- NEW: Property Card Overlay -->
<div id="card-overlay" class="modal-overlay"></div>

<!-- Game Over -->
<div id="game-over-overlay">
    <div class="modal-mini" style="width:600px; display:block; position:relative; top:auto; left:auto; transform:none; animation:none;">
        <h2>üèÜ –ö–†–ê–à –ù–ê –ò–ì–†–ê–¢–ê</h2>
        <p id="report-text" style="text-align:left; line-height:1.6; font-size:0.9rem; max-height: 300px; overflow-y:auto;"></p>
        <div id="qrcode" style="margin:15px auto; display:flex; justify-content:center;"></div>
        <button onclick="clearSave(); location.reload()" style="padding:10px 20px; background:var(--primary-color); color:white; border:none; border-radius:8px; cursor:pointer; margin-top:10px;">–ù–û–í–ê –ò–ì–†–ê</button>
    </div>
</div>

<script src="script.js"></script>
</body>
</html>