<!DOCTYPE html>
<html lang="mk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="author" content="–ò–≥–æ—Ä –ë–æ–≥–¥–∞–Ω–æ—Å–∫–∏">
    <meta name="description" content="–ü—Ä–æ—Ü–µ–Ω—Ç–û–ø–æ–ª–∏—Å - –ï–¥—É–∫–∞—Ç–∏–≤–Ω–∞ –º–∞—Ç–µ–º–∞—Ç–∏—á–∫–∞ –∏–≥—Ä–∞ –∑–∞ —É—á–µ—ö–µ –ø—Ä–æ—Ü–µ–Ω—Ç–∏ –ø—Ä–µ–∫—É –∑–∞–±–∞–≤–Ω–æ —Ç—Ä–≥—É–≤–∞—ö–µ —Å–æ –∏–º–æ—Ç–∏">
    <title>–ü—Ä–æ—Ü–µ–Ω—Ç–û–ø–æ–ª–∏—Å - –ò–≥–æ—Ä –ë–æ–≥–¥–∞–Ω–æ—Å–∫–∏</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- Login -->
<div id="login-overlay">
    <div class="login-container">
        <div class="login-info">
            <h2>üìú –£–ü–ê–¢–°–¢–í–û –ó–ê –ò–ì–†–ê–¢–ê</h2>
            <ul class="rules-list">
                <li class="rule-icon-money"><strong>–¶–µ–ª:</strong> –°–æ–±–µ—Ä–∏ –Ω–∞—ò–≥–æ–ª–µ–º–æ –±–æ–≥–∞—Ç—Å—Ç–≤–æ!</li>
                <li class="rule-icon-calc"><strong>–ö—É–ø—É–≤–∞—ö–µ:</strong> –†–µ—à–∏ –∑–∞–¥–∞—á–∞ –∑–∞ –¥–∞ –∫—É–ø–∏—à –∏–º–æ—Ç.</li>
                <li class="rule-icon-rent"><strong>–ö–∏—Ä–∏—ò–∞:</strong> –ü—Ä–µ—Å–º–µ—Ç–∞—ò —Ç–æ—á–Ω–æ –∏–ª–∏ –ø–ª–∞—Ç–∏ –î–£–ü–õ–û!</li>
            </ul>

            <div class="shop-preview">
                <h3>üõí –ü–†–û–î–ê–í–ù–ò–¶–ê –ó–ê –ú–û–å–ò</h3>
                <div class="shop-preview-grid">
                    <div class="shop-preview-item">‚öñÔ∏è –ê–¥–≤–æ–∫–∞—Ç</div>
                    <div class="shop-preview-item">üõ°Ô∏è –®—Ç–∏—Ç</div>
                    <div class="shop-preview-item">üöÄ –ù–∏—Ç—Ä–æ</div>
                    <div class="shop-preview-item">üïµÔ∏è –ò–Ω—Å–∞—ò–¥–µ—Ä</div>
                </div>
            </div>

            <div class="setup-sidebar" style="margin-top:25px; background: #f0f4f8; padding: 20px; border-radius: 20px; border: 1px solid #d1d9e6;">
                <label style="display:block; font-weight:800; margin-bottom:10px; color:#2c3e50; font-size:0.8rem;">üé≠ –¢–í–û–à–ê–¢–ê –£–õ–û–ì–ê:</label>
                <div class="role-selector" style="display:flex; gap:5px; margin-bottom:20px;">
                    <button id="role-student" class="role-btn active" onclick="setRole('student')">–£–ß–ï–ù–ò–ö</button>
                    <button id="role-teacher" class="role-btn" onclick="setRole('teacher')">–ù–ê–°–¢–ê–í–ù–ò–ö</button>
                </div>

                <div id="student-only-fields">
                    <label style="display:block; font-weight:800; margin-bottom:10px; color:#2c3e50; font-size:0.8rem;">üöÄ –ò–ó–ë–ï–†–ò –ü–ò–û–ù:</label>
                    <div id="token-selector" style="display:flex; gap:8px; justify-content:center; flex-wrap:wrap;">
                        <button onclick="selectToken('üöÄ', this)" class="token-choice active">üöÄ</button>
                        <button onclick="selectToken('üöó', this)" class="token-choice">üöó</button>
                        <button onclick="selectToken('üõ∏', this)" class="token-choice">üõ∏</button>
                        <button onclick="selectToken('ü§ñ', this)" class="token-choice">ü§ñ</button>
                        <button onclick="selectToken('ü¶Ñ', this)" class="token-choice">ü¶Ñ</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="login-form">
            <div class="portal-header">
                <h1>–ü–†–û–¶–ï–ù–¢–û–ü–û–õ–ò–°</h1>
                <p class="subtitle">–ú–ê–°–¢–ï–† –ü–û–†–¢–ê–õ</p>
                <p style="margin-top: 8px; font-size: 0.7rem; color: #94a3b8; font-weight: 600; letter-spacing: 1px;">–ò–∑—Ä–∞–±–æ—Ç–∏–ª: –ò–≥–æ—Ä –ë–æ–≥–¥–∞–Ω–æ—Å–∫–∏</p>
                <div style="margin-top: 10px; font-size: 0.8rem; color: #64748b; font-weight: bold; background: #f1f5f9; display: inline-block; padding: 5px 15px; border-radius: 20px;">
                    –û–ø—Ç–∏–º–∞–ª–Ω–æ: 4-6 –∏–≥—Ä–∞—á–∏
                </div>
            </div>
            
            <div id="auth-section">
                <div class="input-group">
                    <label>üë§ –í–ê–®–ï–¢–û –ò–ú–ï:</label>
                    <input type="text" id="player-name-input" placeholder="–í–Ω–µ—Å–µ—Ç–µ –∏–º–µ..." autocomplete="off">
                    <div id="name-error" style="display:none; color:#ef4444; font-size:0.75rem; margin-top:5px; font-weight:600;"></div>
                </div>

                <div id="student-class-box">
                    <div class="input-group">
                        <label>üè´ –û–î–î–ï–õ–ï–ù–ò–ï:</label>
                        <select id="player-odd-input">
                            <option value="8-1">8-1</option>
                            <option value="8-2">8-2</option>
                            <option value="8-3">8-3</option>
                            <option value="8-4">8-4</option>
                        </select>
                    </div>
                </div>

                <div class="input-group room-box" id="student-room-box">
                    <label id="room-label">üè† –°–û–ë–ê:</label>
                    <div id="available-rooms-container" style="display:none; margin-bottom:10px; max-height:150px; overflow-y:auto; border:1px solid #ddd; border-radius:10px; padding:10px; background:white;">
                        <p style="font-size:0.7rem; color:#666; margin-bottom:5px;">–ò–ó–ë–ï–†–ò –ê–ö–¢–ò–í–ù–ê –°–û–ë–ê:</p>
                        <div id="available-rooms-list" style="display:flex; flex-wrap:wrap; gap:5px;"></div>
                    </div>
                    <input type="text" id="room-id-input" placeholder="–í–Ω–µ—Å–∏ –∏–ª–∏ –∏–∑–±–µ—Ä–∏ –∫–æ–¥..." autocomplete="off">
                    <div id="room-error" style="display:none; color:#ef4444; font-size:0.75rem; margin-top:5px; font-weight:600;"></div>
                </div>

                <button id="login-btn" disabled>üöÄ –í–õ–ï–ó–ò –í–û –ò–ì–†–ê</button>
                <button id="teacher-dashboard-btn" style="display:none; width:100%; padding:20px; font-size:1.2rem; background:#8b5cf6; color:white; border:none; border-radius:16px; cursor:pointer; font-weight:800; margin-top:10px; box-shadow:0 10px 20px rgba(139, 92, 246, 0.3);">üìä –û–¢–í–û–†–ò –ö–û–ù–¢–†–û–õ–ï–ù –ü–ê–ù–ï–õ</button>
            </div>
            <div id="lobby-section" style="display:none;">
                <div style="background: #1e40af; color: white; padding: 20px; border-radius: 20px; margin-bottom: 20px; text-align: center; box-shadow: 0 10px 25px rgba(30, 64, 175, 0.2);">
                    <p style="margin:0; font-size: 0.7rem; text-transform: uppercase; letter-spacing: 2px; font-weight: 800; opacity: 0.8;">–ü–†–ò–ö–õ–£–ß–ò –°–ï –°–û –ö–û–î:</p>
                    <h2 id="current-room-display" style="margin: 5px 0 0 0; font-size: 3rem; font-weight: 950; letter-spacing: 4px;">---</h2>
                </div>
                <div id="players-list" style="margin: 20px 0; text-align: left; background: #f8fafc; padding: 20px; border-radius: 15px; min-height: 120px; border: 1px solid #e2e8f0;">
                    <p style="font-weight: 800; color: #64748b; font-size: 0.8rem; margin-top: 0;">üë• –£–ß–ï–ù–ò–¶–ò –í–û –°–û–ë–ê–¢–ê:</p>
                    <ul id="lobby-players-ul" style="list-style: none; padding: 0; display: grid; grid-template-columns: 1fr 1fr; gap: 10px;"></ul>
                </div>
                
                <div id="teacher-lobby-controls" style="display:none; flex-direction:column; gap:10px;">
                    <button id="open-dash-direct-btn" onclick="openTeacherDash()" style="width: 100%; padding: 18px; background: #8b5cf6; color: white; border: none; border-radius: 16px; font-weight: 900; cursor: pointer; box-shadow: 0 10px 20px rgba(139, 92, 246, 0.2); font-size: 1rem; border: 2px solid rgba(255,255,255,0.2);">üìä –û–¢–í–û–†–ò –ö–û–ù–¢–†–û–õ–ï–ù –¶–ï–ù–¢–ê–†</button>
                    <button id="start-all-rooms-btn" onclick="startAllMyRooms()" style="width: 100%; padding: 15px; background: #3b82f6; color: white; border: none; border-radius: 16px; font-weight: 800; cursor: pointer; font-size: 0.9rem;">üöÄ –°–¢–ê–†–¢–£–í–ê–à –ì–ò –°–ò–¢–ï –°–û–ë–ò</button>
                    <button id="create-another-btn" onclick="location.reload()" style="width: 100%; padding: 12px; background: #f1f5f9; color: #475569; border: 1px solid #e2e8f0; border-radius: 16px; font-weight: 700; cursor: pointer; font-size: 0.8rem;">‚ûï –ö–†–ï–ò–†–ê–à –£–®–¢–ï –ï–î–ù–ê –°–û–ë–ê</button>
                </div>

                <button id="start-game-btn-multi" style="width: 100%; padding: 20px; background: #10b981; color: white; border: none; border-radius: 16px; font-weight: 900; cursor: pointer; box-shadow: 0 10px 20px rgba(16, 185, 129, 0.2); font-size: 1.1rem; margin-top: 10px;">–ó–ê–ü–û–ß–ù–ò –ò–ì–†–ê</button>
                <p style="font-size: 0.75rem; color: #94a3b8; margin-top: 15px; font-weight: 600;">–°–∞–º–æ –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫–æ—Ç –º–æ–∂–µ –¥–∞ —ò–∞ –∑–∞–ø–æ—á–Ω–µ –∏–≥—Ä–∞—Ç–∞.</p>
            </div>
            <button onclick="clearSave()" style="margin-top:10px; background:#e74c3c; border:none; color:white; padding:10px; border-radius:10px; cursor:pointer;">üóëÔ∏è –ò–ó–ë–†–ò–®–ò –ó–ê–ß–£–í–ê–ù–û</button>
        </div>
    </div>
</div>

<!-- Main Game -->
<div id="game-wrapper" class="blur-filter">
    <div id="game-board-container">
        <div id="board"></div>
        <!-- CENTER OF BOARD - Dice, Roll, Timer -->
        <div id="board-center">
            <div id="board-center-timer">
                <span id="class-timer">40:00</span>
                <span id="turn-timer" style="font-weight:bold; color:#3498db;">–ü–æ—Ç–µ–≥: 30s</span>
            </div>
            <div id="dice-container">
                <div class="dice" id="dice-visual">
                    <div class="dice-face f1">1</div><div class="dice-face f2">2</div><div class="dice-face f3">3</div><div class="dice-face f4">4</div><div class="dice-face f5">5</div><div class="dice-face f6">6</div>
                </div>
            </div>
            <button id="roll-btn">üé≤ –§–†–õ–ò</button>
            <button id="shop-btn" onclick="openShop()">üõí –ü–†–û–î–ê–í–ù–ò–¶–ê</button>
            <button id="trade-btn" onclick="openTradeModal()">üîÑ –¢–†–ì–£–í–ê–à</button>
            <div id="board-center-emojis">
                <button onclick="sendEmoji('üòä')">üòä</button>
                <button onclick="sendEmoji('üòé')">üòé</button>
                <button onclick="sendEmoji('üî•')">üî•</button>
                <button onclick="sendEmoji('üëè')">üëè</button>
                <button onclick="sendEmoji('üéâ')">üéâ</button>
            </div>
        </div>
        <div id="token-0" class="token">P1</div>
        <div id="token-1" class="token">P2</div>
        <div id="token-2" class="token">P3</div>
        <div id="token-3" class="token">P4</div>
        <div id="token-4" class="token">P5</div>
        <div id="token-5" class="token">P6</div>
    </div>
    <div id="controls-container">
        <div id="teacher-dash-btn-fixed" style="display:none; margin-bottom:5px;">
            <button onclick="openTeacherDash()" style="width:100%; padding:10px; background:#8b5cf6; color:white; border:none; border-radius:10px; font-weight:900; cursor:pointer; box-shadow:0 4px 12px rgba(139, 92, 246, 0.3); font-size:0.85rem;">üìä –ö–û–ù–¢–†–û–õ–ï–ù –ü–ê–ù–ï–õ</button>
        </div>
        <div class="header-info">
            <div><h1 style="font-size:1rem; margin:0;">–ü—Ä–æ—Ü–µ–Ω—Ç–û–ø–æ–ª–∏—Å</h1><span id="player-display-name" style="font-size:0.75rem; font-weight:bold; color:#555;">–£—á–µ–Ω–∏–∫</span></div>
        </div>
        <div class="stats-panel" id="stats-panel-multi">
            <!-- Players stats will be injected here -->
        </div>
        <div id="game-log"></div>
        <button id="end-game-btn" onclick="triggerGameOver('–†–∞—á–µ–Ω –∫—Ä–∞—ò')" style="margin-top:3px; font-size:0.7rem; background:transparent; border:1px solid #ccc; color:#888; padding:4px; border-radius:6px; width:100%; cursor:pointer;">üèÅ –ò–ó–í–ï–®–¢–ê–à</button>
    </div>
</div>

<!-- TEACHER DASHBOARD MODAL -->
<div id="teacher-modal" class="modal-overlay">
    <div class="modal-content teacher-modal-content">
        <!-- Sidebar for Room Selection -->
        <div id="teacher-sidebar">
            <div style="padding:25px; border-bottom:1px solid rgba(255,255,255,0.1);">
                <h3 style="margin:0; font-size:1.1rem; letter-spacing:1px;">üè´ –ú–û–ò –°–û–ë–ò</h3>
                <p style="margin:5px 0 0 0; font-size:0.7rem; color:#94a3b8;">–ò–∑–±–µ—Ä–∏ —Å–æ–±–∞ –∑–∞ –¥–µ—Ç–∞–ª–µ–Ω —É–≤–∏–¥</p>
            </div>
            <div id="dash-rooms-list" style="flex:1; overflow-y:auto; padding:15px;">
                <!-- Room buttons will be injected here -->
            </div>
            <div style="padding:20px; background:rgba(0,0,0,0.2); display:flex; flex-direction:column; gap:10px;">
                <button onclick="showCreateRoomInterface()" style="width:100%; padding:10px; background:#3b82f6; color:white; border:none; border-radius:8px; font-weight:bold; cursor:pointer;">+ –ö–†–ï–ò–†–ê–à –ù–û–í–ò</button>
                <button onclick="clearAllMyRooms()" style="width:100%; padding:8px; background:rgba(239, 68, 68, 0.2); color:#f87171; border:1px solid #ef4444; border-radius:8px; font-size:0.75rem; font-weight:bold; cursor:pointer;">üóëÔ∏è –ò–ó–ë–†–ò–®–ò –°–ò–¢–ï</button>
            </div>
        </div>

        <!-- Main Content Area -->
        <div style="flex:1; display:flex; flex-direction:column; background:#f8fafc;">
            <div class="modal-header" style="background: white; padding:14px 24px; border-bottom: 1px solid #e2e8f0; display:flex; justify-content:space-between; align-items:center;">
                <div style="display:flex; align-items:center; gap:12px;">
                    <button id="dash-back-to-list" style="display:none; background:#f1f5f9; border:none; padding:6px 12px; border-radius:8px; cursor:pointer; font-weight:bold; font-size:0.85rem;" onclick="toggleGridView(false)">‚¨ÖÔ∏è –ù–ê–ó–ê–î</button>
                    <div>
                        <h2 id="dash-active-room-title" style="margin:0; color:#1e293b; font-size:1.3rem; font-weight:900;">–ì–õ–ê–í–ï–ù –ü–ê–ù–ï–õ</h2>
                        <p id="dash-room-status" style="margin:0; color:#64748b; font-weight:500; font-size:0.8rem;">–ò–∑–±–µ—Ä–µ—Ç–µ —Å–æ–±–∞ –æ–¥ –ª–µ–≤–∞—Ç–∞ —Å—Ç—Ä–∞–Ω–∞</p>
                    </div>
                </div>
                <div style="display:flex; gap:8px;">
                    <button id="dash-download-btn" style="display:none; background:#34495e; color:white; border:none; border-radius:8px; padding:8px 14px; font-weight:bold; cursor:pointer; font-size:0.8rem;" onclick="downloadRoomReport()">üì• –ò–ó–í–ï–®–¢–ê–à</button>
                    <button id="dash-grid-view-btn" onclick="toggleGridView(true)" style="background:#8b5cf6; color:white; border:none; border-radius:8px; padding:8px 14px; font-weight:bold; cursor:pointer; font-size:0.8rem;">üì± –°–ò–¢–ï –°–û–ë–ò</button>
                    <button id="dash-start-btn" style="display:none; background:#10b981; color:white; border:none; border-radius:8px; padding:8px 14px; font-weight:bold; cursor:pointer; font-size:0.8rem;">–°–¢–ê–†–¢–£–í–ê–à</button>
                    <button onclick="closeTeacherDash()" style="background:#f1f5f9; border:none; border-radius:8px; padding:8px 14px; color:#475569; font-weight:bold; cursor:pointer; font-size:0.8rem;">–ó–ê–¢–í–û–†–ò</button>
                </div>
            </div>
            
            <div id="dash-main-scroll" style="padding:20px 24px; overflow-y:auto; flex:1;">
                <!-- Grid View Container (Hidden by default) -->
                <div id="dash-grid-container" style="display:none; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap:25px;">
                    <!-- Room summary cards injected here -->
                </div>

                <!-- Create Room Interface (shown when + –ö–†–ï–ò–†–ê–à –ù–û–í–ò is clicked) -->
                <div id="dash-create-room-container" style="display:none;"></div>

                <!-- Single Room View Container -->
                <div id="dash-single-room-container">
                    <!-- Compact Stats Cards -->
                    <div class="dash-stats-row">
                        <div class="dash-stat-card">
                            <span class="dash-stat-icon">üë•</span>
                            <div>
                                <div class="dash-stat-label">–£—á–µ–Ω–∏—Ü–∏</div>
                                <div class="dash-stat-value" id="dash-player-count">0</div>
                            </div>
                        </div>
                        <div class="dash-stat-card">
                            <span class="dash-stat-icon">‚úÖ</span>
                            <div>
                                <div class="dash-stat-label">–¢–æ—á–Ω–∏</div>
                                <div class="dash-stat-value" style="color:#10b981;" id="dash-total-correct">0</div>
                            </div>
                        </div>
                        <div class="dash-stat-card">
                            <span class="dash-stat-icon">üìà</span>
                            <div>
                                <div class="dash-stat-label">–£—Å–ø–µ—Ö</div>
                                <div class="dash-stat-value" style="color:#3b82f6;" id="dash-avg-success">0%</div>
                            </div>
                        </div>
                    </div>

                    <!-- Tab Navigation -->
                    <div class="dash-tabs">
                        <button class="dash-tab active" onclick="switchDashTab('players')" id="dash-tab-players">üë• –£—á–µ–Ω–∏—Ü–∏</button>
                        <button class="dash-tab" onclick="switchDashTab('live')" id="dash-tab-live">üéÆ Live –°—Ç–∞—Ç—É—Å</button>
                        <button class="dash-tab" onclick="switchDashTab('analytics')" id="dash-tab-analytics">üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</button>
                    </div>

                    <!-- TAB 1: Players Table -->
                    <div id="dash-panel-players" class="dash-tab-panel active">
                        <div style="background:white; border-radius:16px; box-shadow:0 4px 12px rgba(0,0,0,0.03); border:1px solid #e2e8f0; overflow:hidden;">
                            <table style="width:100%; border-collapse: collapse; text-align:left;">
                                <thead style="background:#f1f5f9;">
                                    <tr>
                                        <th style="padding:14px 16px; color:#475569; font-weight:700; font-size:0.75rem;">–£–ß–ï–ù–ò–ö</th>
                                        <th style="padding:14px 16px; color:#475569; font-weight:700; font-size:0.75rem;">–ë–û–ì–ê–¢–°–¢–í–û</th>
                                        <th style="padding:14px 16px; color:#475569; font-weight:700; font-size:0.75rem;">–¢–û–ß–ù–ò / –ì–†–ï–®–ù–ò</th>
                                        <th style="padding:14px 16px; color:#475569; font-weight:700; font-size:0.75rem;">–ê–ö–¢–ò–í–ù–û–°–¢</th>
                                        <th style="padding:14px 16px; color:#475569; font-weight:700; font-size:0.75rem;">–°–¢–ê–¢–£–°</th>
                                    </tr>
                                </thead>
                                <tbody id="teacher-stats-tbody">
                                    <!-- Player rows injected here -->
                                </tbody>
                            </table>
                            <div id="dash-empty-state" style="padding:60px; text-align:center; color:#94a3b8;">
                                <div style="font-size:3rem; margin-bottom:15px;">üïµÔ∏è‚Äç‚ôÇÔ∏è</div>
                                <h3 style="margin:0 0 5px 0;">–ù–µ–º–∞ –∞–∫—Ç–∏–≤–Ω–∏ —É—á–µ–Ω–∏—Ü–∏</h3>
                                <p style="margin:0; font-size:0.85rem;">–ß–µ–∫–∞–º–µ —É—á–µ–Ω–∏—Ü–∏—Ç–µ –¥–∞ —Å–µ –ø—Ä–∏–∫–ª—É—á–∞—Ç —Å–æ –∫–æ–¥–æ—Ç.</p>
                            </div>
                        </div>
                    </div>

                    <!-- TAB 2: Live Status -->
                    <div id="dash-panel-live" class="dash-tab-panel" style="display:none;">
                        <div id="dash-viz-panel">
                            <!-- Live Game Status -->
                            <div style="background:linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius:15px; padding:18px; margin-bottom:16px; color:white;">
                                <h3 style="margin:0 0 12px 0; font-size:1rem; display:flex; align-items:center; gap:8px;">
                                    <span style="font-size:1.2rem;">üéÆ</span> Live –°—Ç–∞—Ç—É—Å
                                </h3>
                                <div style="display:grid; grid-template-columns: repeat(4, 1fr); gap:12px;">
                                    <div style="background:rgba(255,255,255,0.15); padding:12px; border-radius:10px;">
                                        <div style="font-size:0.65rem; opacity:0.9; margin-bottom:4px;">‚è±Ô∏è –ü–†–ï–û–°–¢–ê–ù–ê–¢–û</div>
                                        <div id="dash-viz-time-left" style="font-size:1.3rem; font-weight:900;">--:--</div>
                                    </div>
                                    <div style="background:rgba(255,255,255,0.15); padding:12px; border-radius:10px;">
                                        <div style="font-size:0.65rem; opacity:0.9; margin-bottom:4px;">üë§ –ù–ê –ü–û–¢–ï–ì</div>
                                        <div id="dash-viz-current-player" style="font-size:1.3rem; font-weight:900;">---</div>
                                    </div>
                                    <div style="background:rgba(255,255,255,0.15); padding:12px; border-radius:10px;">
                                        <div style="font-size:0.65rem; opacity:0.9; margin-bottom:4px;">üéØ –ü–û–¢–ï–ó–ò</div>
                                        <div id="dash-viz-total-moves" style="font-size:1.3rem; font-weight:900;">0</div>
                                    </div>
                                    <div style="background:rgba(255,255,255,0.15); padding:12px; border-radius:10px;">
                                        <div style="font-size:0.65rem; opacity:0.9; margin-bottom:4px;">‚è≤Ô∏è –ü–û–¢–ï–ì</div>
                                        <div id="dash-viz-turn-time" style="font-size:1.3rem; font-weight:900;">--s</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Money Distribution Chart -->
                            <div style="background:white; border-radius:15px; padding:18px; box-shadow:0 4px 15px rgba(0,0,0,0.05);">
                                <h3 style="margin:0 0 14px 0; color:#1e293b; font-size:1rem; display:flex; align-items:center; gap:8px;">
                                    <span style="font-size:1.2rem;">üí∞</span> –†–∞—Å–ø—Ä–µ–¥–µ–ª–±–∞ –Ω–∞ –ü–∞—Ä–∏
                                </h3>
                                <div id="dash-viz-money-chart" style="display:flex; flex-direction:column; gap:10px;">
                                    <!-- Money bars will be injected here -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- TAB 3: Analytics -->
                    <div id="dash-panel-analytics" class="dash-tab-panel" style="display:none;">
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:16px;">
                            <!-- Property Ownership -->
                            <div style="background:white; border-radius:15px; padding:18px; box-shadow:0 4px 15px rgba(0,0,0,0.05);">
                                <h3 style="margin:0 0 14px 0; color:#1e293b; font-size:1rem; display:flex; align-items:center; gap:8px;">
                                    <span style="font-size:1.2rem;">üèòÔ∏è</span> –ü–æ—Å–µ–¥—É–≤–∞–Ω–∏ –ò–º–æ—Ç–∏
                                </h3>
                                <div id="dash-viz-properties" style="display:flex; flex-direction:column; gap:8px;">
                                    <!-- Property counts will be injected here -->
                                </div>
                            </div>

                            <!-- Question Difficulty Breakdown -->
                            <div style="background:white; border-radius:15px; padding:18px; box-shadow:0 4px 15px rgba(0,0,0,0.05);">
                                <h3 style="margin:0 0 14px 0; color:#1e293b; font-size:1rem; display:flex; align-items:center; gap:8px;">
                                    <span style="font-size:1.2rem;">üìä</span> –¢–µ–∂–∏–Ω–∞ –Ω–∞ –ü—Ä–∞—à–∞—ö–∞
                                </h3>
                                <div id="dash-viz-difficulty" style="display:flex; flex-direction:column; gap:12px;">
                                    <!-- Difficulty stats will be injected here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Question Modal -->
<div id="question-modal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header" style="background:var(--primary-color); color:white; padding:15px; font-weight:bold; display:flex; justify-content:space-between;">
            <span id="modal-category">–ó–∞–¥–∞—á–∞</span>
            <span onclick="closeModal()" style="cursor:pointer; font-size:1.5rem;">&times;</span>
        </div>
        <div class="modal-body">
            <div class="question-side">
                <div id="question-text" style="font-size:1.3rem; font-weight:bold; margin-bottom:20px;">...</div>
                <div id="options-container"></div>
                <div id="input-answer-container">
                    <p style="font-size:0.9rem; color:#666; margin-bottom:5px;">–í–ø–∏—à–∏ –±—Ä–æ—ò (–∫–æ—Ä–∏—Å—Ç–∏ —Ç–æ—á–∫–∞ –∑–∞ –¥–µ—Ü–∏–º–∞–ª–∏):</p>
                    <input type="text" id="manual-answer-input" placeholder="–ø—Ä. 25.5">
                    <button id="submit-answer-btn">–ü–û–¢–í–†–î–ò –û–î–ì–û–í–û–†</button>
                </div>
                <button class="action-btn btn-hint" onclick="drawVisualHint()">üé® –í–ò–ó–£–ï–õ–ù–ê –ü–û–ú–û–® (HINT)</button>
                <div id="feedback-area" style="margin-top:20px; font-weight:bold;"></div>
            </div>
            <div class="whiteboard-side" id="canvas-parent">
                <canvas id="whiteboard"></canvas>
                <div class="canvas-tools" style="position:absolute; bottom:15px; left:50%; transform:translateX(-50%); background:white; padding:10px 20px; border-radius:30px; box-shadow:0 4px 15px rgba(0,0,0,0.2); z-index:100; display:flex; gap:15px; align-items:center;">
                    <div style="display:flex; gap:5px;">
                        <button onclick="changeColor('#000000')" style="width:25px; height:25px; border-radius:50%; background:black; border:2px solid #ddd; cursor:pointer;"></button>
                        <button onclick="changeColor('#e74c3c')" style="width:25px; height:25px; border-radius:50%; background:#e74c3c; border:2px solid #ddd; cursor:pointer;"></button>
                        <button onclick="changeColor('#3498db')" style="width:25px; height:25px; border-radius:50%; background:#3498db; border:2px solid #ddd; cursor:pointer;"></button>
                        <button onclick="changeColor('#2ecc71')" style="width:25px; height:25px; border-radius:50%; background:#2ecc71; border:2px solid #ddd; cursor:pointer;"></button>
                    </div>
                    <div style="height:20px; width:1px; background:#ddd;"></div>
                    <input type="range" id="pen-width" min="1" max="10" value="3" style="width:80px;">
                    <div style="height:20px; width:1px; background:#ddd;"></div>
                    <button onclick="clearCanvas()" style="background:none; border:none; font-size:1.2rem; cursor:pointer;" title="–ò–∑–±—Ä–∏—à–∏ —Å–µ">üóëÔ∏è</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- SHOP MODAL -->
<div id="shop-modal" class="modal-overlay">
    <div class="modal-mini" style="width:600px; display:block; position:relative; top:auto; left:auto; transform:none; animation:none;">
        <h2>üõí –ü–†–û–î–ê–í–ù–ò–¶–ê –ó–ê –ú–û–å–ò</h2>
        <p>–ò—Å–∫–æ—Ä–∏—Å—Ç–∏ –≥–∏ –ø–∞—Ä–∏—Ç–µ –∑–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—ò–∞!</p>
        <div class="shop-grid">
            <div class="shop-item" onclick="buyItem('lawyer', 300)"><div class="shop-icon">‚öñÔ∏è</div><h3>–ê–¥–≤–æ–∫–∞—Ç</h3><p>–¢–µ —à—Ç–∏—Ç–∏ –æ–¥ —Å–ª–µ–¥–Ω–∞—Ç–∞ –¥–∞–Ω–æ—á–Ω–∞ –∏–Ω—Å–ø–µ–∫—Ü–∏—ò–∞.</p><div class="shop-price">300–¥</div></div>
            <div class="shop-item" onclick="buyItem('shield', 250)"><div class="shop-icon">üõ°Ô∏è</div><h3>–ó–ª–∞—Ç–µ–Ω –®—Ç–∏—Ç</h3><p>–ï–¥–Ω–∞—à –Ω–µ –ø–ª–∞—ú–∞—à –∫–∏—Ä–∏—ò–∞ –∫–∞—ò –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫.</p><div class="shop-price">250–¥</div></div>
            <div class="shop-item" onclick="buyItem('nitro', 150)"><div class="shop-icon">üöÄ</div><h3>–ù–∏—Ç—Ä–æ –ö–æ—Ü–∫–∞</h3><p>–°–ª–µ–¥–Ω–æ—Ç–æ —Ñ—Ä–ª–∞—ö–µ –µ —Å–æ –¥—É–ø–ª–∞ –≤—Ä–µ–¥–Ω–æ—Å—Ç.</p><div class="shop-price">150–¥</div></div>
            <div class="shop-item" onclick="buyItem('bribe', 500)"><div class="shop-icon">üïµÔ∏è</div><h3>–ò–Ω—Å–∞—ò–¥–µ—Ä</h3><p>–ó–µ–º–∏ –≥–æ —Å–ª–µ–¥–Ω–∏–æ—Ç –∏–º–æ—Ç –Ω–∞ –∫–æ—ò —ú–µ –∑–∞—Å—Ç–∞–Ω–µ—à –∑–∞ 1 –¥–µ–Ω–∞—Ä.</p><div class="shop-price">500–¥</div></div>
        </div>
        <button class="action-btn btn-pass" style="margin-top:20px; width:100%;" onclick="document.getElementById('shop-modal').style.display='none'">–ó–ê–¢–í–û–†–ò</button>
    </div>
</div>

<!-- NEW: Property Card Overlay -->
<div id="card-overlay" class="modal-overlay"></div>

<!-- Game Over -->
<div id="game-over-overlay">
    <div class="modal-mini" style="width:600px; display:block; position:relative; top:auto; left:auto; transform:none; animation:none;">
        <h2>üèÜ –ö–†–ê–à –ù–ê –ò–ì–†–ê–¢–ê</h2>
        <p id="report-text" style="text-align:left; line-height:1.6; font-size:0.9rem; max-height: 300px; overflow-y:auto;"></p>
        <div id="qrcode" style="margin:15px auto; display:flex; justify-content:center;"></div>
        <button onclick="clearSave(); location.reload()" style="padding:10px 20px; background:var(--primary-color); color:white; border:none; border-radius:8px; cursor:pointer; margin-top:10px;">–ù–û–í–ê –ò–ì–†–ê</button>
        <p style="margin-top:15px; font-size:0.65rem; color:#94a3b8; font-weight:600;">–ü—Ä–æ—Ü–µ–Ω—Ç–û–ø–æ–ª–∏—Å &copy; –ò–≥–æ—Ä –ë–æ–≥–¥–∞–Ω–æ—Å–∫–∏</p>
    </div>
</div>

<!-- TRADE MODAL -->
<div id="trade-overlay" class="modal-overlay" style="display:none; z-index:9500;">
    <div class="trade-modal">
        <div class="trade-header">
            <h2>üîÑ –¢–†–ì–£–í–ê–ä–ï</h2>
            <button class="trade-close-btn" onclick="closeTradeModal()">&times;</button>
        </div>
        <div class="trade-steps">
            <div class="trade-step active" id="trade-step-1">1</div>
            <div class="trade-step-line"></div>
            <div class="trade-step" id="trade-step-2">2</div>
            <div class="trade-step-line"></div>
            <div class="trade-step" id="trade-step-3">3</div>
        </div>
        <!-- Step 1: Select your property -->
        <div id="trade-page-1" class="trade-page">
            <h3>–ò–∑–±–µ—Ä–∏ —Ç–≤–æ—ò –∏–º–æ—Ç –∑–∞ –ø–æ–Ω—É–¥–∞</h3>
            <div id="trade-my-props" class="trade-props-grid"></div>
        </div>
        <!-- Step 2: Select target player + their property -->
        <div id="trade-page-2" class="trade-page" style="display:none;">
            <h3>–ò–∑–±–µ—Ä–∏ –∏–≥—Ä–∞—á –∏ –Ω–µ–≥–æ–≤ –∏–º–æ—Ç</h3>
            <div id="trade-players-list" class="trade-players-list"></div>
            <div id="trade-their-props" class="trade-props-grid"></div>
        </div>
        <!-- Step 3: Money + Confirm -->
        <div id="trade-page-3" class="trade-page" style="display:none;">
            <h3>–î–æ–¥–∞—ò –ø–∞—Ä–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª–Ω–æ)</h3>
            <div id="trade-summary" class="trade-summary"></div>
            <div class="trade-money-input">
                <label>–î–æ–¥–∞—Ç–Ω–∏ –ø–∞—Ä–∏ (–¥):</label>
                <input type="number" id="trade-money-amount" value="0" min="0" step="50">
            </div>
            <button id="trade-send-btn" class="trade-action-btn" onclick="sendTradeOffer()">üì® –ü–û–ù–£–î–ò –¢–†–ì–£–í–ê–ä–ï</button>
        </div>
        <div class="trade-nav">
            <button id="trade-back-btn" class="trade-nav-btn" onclick="tradeStepBack()" style="display:none;">‚Üê –ù–∞–∑–∞–¥</button>
            <button id="trade-next-btn" class="trade-nav-btn" onclick="tradeStepNext()" style="display:none;">–°–ª–µ–¥–Ω–æ ‚Üí</button>
        </div>
    </div>
</div>

<!-- INCOMING TRADE OFFER MODAL -->
<div id="trade-incoming-overlay" class="modal-overlay" style="display:none; z-index:9600;">
    <div class="trade-incoming-modal">
        <h2>üì© –ü–û–ù–£–î–ê –ó–ê –¢–†–ì–£–í–ê–ä–ï</h2>
        <div id="trade-incoming-details"></div>
        <div class="trade-incoming-actions">
            <button class="trade-action-btn trade-accept" onclick="acceptTrade()">‚úÖ –ü–†–ò–§–ê–¢–ò</button>
            <button class="trade-action-btn trade-reject" onclick="rejectTrade()">‚ùå –û–î–ë–ò–à</button>
        </div>
    </div>
</div>

<!-- PHASE 2: Onboarding Tutorial -->
<div id="tutorial-overlay">
    <div class="tutorial-modal">
        <div class="tutorial-header">
            <div class="tutorial-icon" id="tutorial-icon">üéÆ</div>
            <h2 class="tutorial-title" id="tutorial-title">–î–æ–±—Ä–µ–¥–æ—ò–¥–µ!</h2>
            <p class="tutorial-subtitle" id="tutorial-subtitle">–ê—ò–¥–µ –¥–∞ –Ω–∞—É—á–∏–º–µ –∫–∞–∫–æ —Å–µ –∏–≥—Ä–∞</p>
        </div>
        <div class="tutorial-content" id="tutorial-content">
            <!-- Content will be dynamically injected -->
        </div>
        <div class="tutorial-footer">
            <div class="tutorial-progress" id="tutorial-progress">–ß–µ–∫–æ—Ä 1 –æ–¥ 7</div>
            <div class="tutorial-nav">
                <button class="tutorial-btn tutorial-btn-skip" onclick="skipTutorial()">–ü—Ä–µ—Å–∫–æ–∫–Ω–∏</button>
                <button class="tutorial-btn tutorial-btn-next" id="tutorial-next-btn" onclick="nextTutorialStep()">–°–ª–µ–¥–Ω–æ ‚Üí</button>
            </div>
        </div>
    </div>
</div>

<!-- PHASE 2: Confetti Container -->
<div id="confetti-container" class="confetti-container"></div>

<script src="script.js"></script>
</body>
</html>