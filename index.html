<!DOCTYPE html>
<html lang="mk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Percentopolis - –ü—Ä–æ—Ü–µ–Ω—Ç–û–ø–æ–ª–∏—Å</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- Login -->
<div id="login-overlay">
    <div class="login-container">
        <div class="login-info">
            <h2>üìú –£–ü–ê–¢–°–¢–í–û –ó–ê –ò–ì–†–ê–¢–ê</h2>
            <ul class="rules-list">
                <li class="rule-icon-money"><strong>–¶–µ–ª:</strong> –°–æ–±–µ—Ä–∏ –Ω–∞—ò–≥–æ–ª–µ–º–æ –±–æ–≥–∞—Ç—Å—Ç–≤–æ!</li>
                <li class="rule-icon-calc"><strong>–ö—É–ø—É–≤–∞—ö–µ:</strong> –†–µ—à–∏ –∑–∞–¥–∞—á–∞ –∑–∞ –¥–∞ –∫—É–ø–∏—à –∏–º–æ—Ç. –ù–∞—ò—Å–∫–∞–ø–∏—Ç–µ (–ñ–æ–ª—Ç–∏) –±–∞—Ä–∞–∞—Ç –≤–ø–∏—à—É–≤–∞—ö–µ –æ–¥–≥–æ–≤–æ—Ä.</li>
                <li class="rule-icon-rent"><strong>–ö–∏—Ä–∏—ò–∞:</strong> –ü—Ä–µ—Å–º–µ—Ç–∞—ò —Ç–æ—á–Ω–æ –∏–ª–∏ –ø–ª–∞—Ç–∏ –î–£–ü–õ–û!</li>
                <li class="rule-icon-build"><strong>–°—Ç—Ä–∞—Ç–µ–≥–∏—ò–∞:</strong> –ö—É–ø—É–≤–∞—ò –º–æ—ú–∏ –≤–æ –ø—Ä–æ–¥–∞–≤–Ω–∏—Ü–∞—Ç–∞.</li>
                <li class="rule-icon-steal"><strong>–ò–Ω—Ñ–æ:</strong> –ò–≥—Ä–∞—Ç–∞ —Å–µ –∑–∞—á—É–≤—É–≤–∞ –∞–≤—Ç–æ–º–∞—Ç—Å–∫–∏.</li>
            </ul>

            <div class="shop-preview">
                <h3>üõí –°–¢–†–ê–¢–ï–ì–ò–à–ê: –ü–†–û–î–ê–í–ù–ò–¶–ê</h3>
                <div class="shop-preview-grid">
                    <div class="shop-preview-item">‚öñÔ∏è <strong>–ê–¥–≤–æ–∫–∞—Ç:</strong> –®—Ç–∏—Ç –æ–¥ –¥–∞–Ω–æ–∫</div>
                    <div class="shop-preview-item">üõ°Ô∏è <strong>–®—Ç–∏—Ç:</strong> –®—Ç–∏—Ç –æ–¥ –∫–∏—Ä–∏—ò–∞</div>
                    <div class="shop-preview-item">üöÄ <strong>–ù–∏—Ç—Ä–æ:</strong> –î—É–ø–ª–æ –¥–≤–∏–∂–µ—ö–µ</div>
                    <div class="shop-preview-item">üïµÔ∏è <strong>–ò–Ω—Å–∞—ò–¥–µ—Ä:</strong> –ï–≤—Ç–∏–Ω –∏–º–æ—Ç</div>
                </div>
            </div>
        </div>
        <div class="login-form">
            <h1>üèôÔ∏è –ü–†–û–¶–ï–ù–¢–û–ü–û–õ–ò–°</h1>
            <p class="subtitle">–ú–∞—Ç–µ–º–∞—Ç–∏—á–∫–∞ –∞–≤–∞–Ω—Ç—É—Ä–∞</p>
            <div id="auth-section">
                <div class="input-group"><label>–ò–º–µ –∏ –ø—Ä–µ–∑–∏–º–µ:</label><input type="text" id="player-name-input" placeholder="–í–Ω–µ—Å–µ—Ç–µ –∏–º–µ..." autocomplete="off"></div>
                <div class="input-group"><label>–û–¥–¥–µ–ª–µ–Ω–∏–µ:</label><select id="player-odd-input"><option value="8-1">8-1</option><option value="8-2">8-2</option><option value="8-3">8-3</option><option value="8-4">8-4</option></select></div>
                <div class="input-group"><label>–°–æ–±–∞ ID (–æ—Å—Ç–∞–≤–∏ –ø—Ä–∞–∑–Ω–æ –∑–∞ –Ω–æ–≤–∞):</label><input type="text" id="room-id-input" placeholder="–ø—Ä. ROOM123" autocomplete="off"></div>
                <button id="login-btn" disabled>üöÄ –ü–†–ò–ö–õ–£–ß–ò –°–ï / –ö–†–ï–ò–†–ê–à –°–û–ë–ê</button>
            </div>
            <div id="lobby-section" style="display:none;">
                <h2 id="current-room-display">–°–æ–±–∞: ---</h2>
                <div id="players-list" style="margin: 20px 0; text-align: left; background: #f8f9fa; padding: 15px; border-radius: 10px; min-height: 100px;">
                    <p>–ò–≥—Ä–∞—á–∏ –≤–æ —Å–æ–±–∞—Ç–∞:</p>
                    <ul id="lobby-players-ul" style="list-style: none; padding: 0;"></ul>
                </div>
                <button id="start-game-btn-multi" style="width: 100%; padding: 15px; background: #27ae60; color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer;">–ó–ê–ü–û–ß–ù–ò –ò–ì–†–ê</button>
                <p style="font-size: 0.8rem; color: #666; margin-top: 10px;">–°–∞–º–æ –∫—Ä–µ–∞—Ç–æ—Ä–æ—Ç –Ω–∞ —Å–æ–±–∞—Ç–∞ –º–æ–∂–µ –¥–∞ —ò–∞ –∑–∞–ø–æ—á–Ω–µ –∏–≥—Ä–∞—Ç–∞.</p>
            </div>
            <button onclick="clearSave()" style="margin-top:10px; background:#e74c3c; border:none; color:white; padding:10px; border-radius:10px; cursor:pointer;">üóëÔ∏è –ò–ó–ë–†–ò–®–ò –ó–ê–ß–£–í–ê–ù–û</button>
        </div>
    </div>
</div>

<!-- Main Game -->
<div id="game-wrapper" class="blur-filter">
    <div id="game-board-container">
        <div id="board"></div>
        <div id="token-0" class="token">P1</div>
        <div id="token-1" class="token">P2</div>
        <div id="token-2" class="token">P3</div>
        <div id="token-3" class="token">P4</div>
        <div id="token-4" class="token">P5</div>
        <div id="token-5" class="token">P6</div>
    </div>
    <div id="controls-container">
        <div class="header-info">
            <div><h1 style="font-size:1.1rem; margin:0;">–ü—Ä–æ—Ü–µ–Ω—Ç–û–ø–æ–ª–∏—Å</h1><span id="player-display-name" style="font-size:0.8rem; font-weight:bold; color:#555;">–£—á–µ–Ω–∏–∫</span></div>
            <div style="display:flex; flex-direction:column; align-items:flex-end;"><div id="class-timer">40:00</div></div>
        </div>
        <div class="stats-panel" id="stats-panel-multi">
            <!-- Players stats will be injected here -->
        </div>
        <div id="game-log"></div>
        <div id="dice-container">
            <div class="dice" id="dice-visual">
                <div class="dice-face f1">1</div><div class="dice-face f2">2</div><div class="dice-face f3">3</div><div class="dice-face f4">4</div><div class="dice-face f5">5</div><div class="dice-face f6">6</div>
            </div>
        </div>
        <button id="roll-btn">üé≤ –§–†–õ–ò</button>
        <button id="shop-btn" onclick="openShop()">üõí –ü–†–û–î–ê–í–ù–ò–¶–ê</button>
        <button id="end-game-btn" onclick="triggerGameOver('–†–∞—á–µ–Ω –∫—Ä–∞—ò')" style="margin-top:5px; font-size:0.8rem; background:transparent; border:1px solid #ccc; color:#888;">üèÅ –ò–ó–í–ï–®–¢–ê–à</button>
    </div>
</div>

<!-- Question Modal -->
<div id="question-modal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header" style="background:var(--primary-color); color:white; padding:15px; font-weight:bold; display:flex; justify-content:space-between;">
            <span id="modal-category">–ó–∞–¥–∞—á–∞</span>
            <span onclick="closeModal()" style="cursor:pointer; font-size:1.5rem;">&times;</span>
        </div>
        <div class="modal-body">
            <div class="question-side">
                <div id="question-text" style="font-size:1.3rem; font-weight:bold; margin-bottom:20px;">...</div>
                <div id="options-container"></div>
                <div id="input-answer-container">
                    <p style="font-size:0.9rem; color:#666; margin-bottom:5px;">–í–ø–∏—à–∏ –±—Ä–æ—ò (–∫–æ—Ä–∏—Å—Ç–∏ —Ç–æ—á–∫–∞ –∑–∞ –¥–µ—Ü–∏–º–∞–ª–∏):</p>
                    <input type="text" id="manual-answer-input" placeholder="–ø—Ä. 25.5">
                    <button id="submit-answer-btn">–ü–û–¢–í–†–î–ò –û–î–ì–û–í–û–†</button>
                </div>
                <button class="action-btn btn-hint" onclick="drawVisualHint()">üé® –í–ò–ó–£–ï–õ–ù–ê –ü–û–ú–û–® (HINT)</button>
                <div id="feedback-area" style="margin-top:20px; font-weight:bold;"></div>
            </div>
            <div class="whiteboard-side" id="canvas-parent">
                <canvas id="whiteboard"></canvas>
                <div style="position:absolute; bottom:15px; left:50%; transform:translateX(-50%); background:white; padding:5px 15px; border-radius:20px; box-shadow:0 2px 10px rgba(0,0,0,0.1); z-index:100;">
                    <button onclick="clearCanvas()" style="padding:5px 10px; border-radius:5px; border:1px solid #ddd; cursor:pointer;">üóëÔ∏è –ò–∑–±—Ä–∏—à–∏</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- SHOP MODAL -->
<div id="shop-modal" class="modal-overlay">
    <div class="modal-mini" style="width:600px; display:block; position:relative; top:auto; left:auto; transform:none; animation:none;">
        <h2>üõí –ü–†–û–î–ê–í–ù–ò–¶–ê –ó–ê –ú–û–å–ò</h2>
        <p>–ò—Å–∫–æ—Ä–∏—Å—Ç–∏ –≥–∏ –ø–∞—Ä–∏—Ç–µ –∑–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—ò–∞!</p>
        <div class="shop-grid">
            <div class="shop-item" onclick="buyItem('lawyer', 300)"><div class="shop-icon">‚öñÔ∏è</div><h3>–ê–¥–≤–æ–∫–∞—Ç</h3><p>–¢–µ —à—Ç–∏—Ç–∏ –æ–¥ —Å–ª–µ–¥–Ω–∞—Ç–∞ –¥–∞–Ω–æ—á–Ω–∞ –∏–Ω—Å–ø–µ–∫—Ü–∏—ò–∞.</p><div class="shop-price">300–¥</div></div>
            <div class="shop-item" onclick="buyItem('shield', 250)"><div class="shop-icon">üõ°Ô∏è</div><h3>–ó–ª–∞—Ç–µ–Ω –®—Ç–∏—Ç</h3><p>–ï–¥–Ω–∞—à –Ω–µ –ø–ª–∞—ú–∞—à –∫–∏—Ä–∏—ò–∞ –∫–∞—ò –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫.</p><div class="shop-price">250–¥</div></div>
            <div class="shop-item" onclick="buyItem('nitro', 150)"><div class="shop-icon">üöÄ</div><h3>–ù–∏—Ç—Ä–æ –ö–æ—Ü–∫–∞</h3><p>–°–ª–µ–¥–Ω–æ—Ç–æ —Ñ—Ä–ª–∞—ö–µ –µ —Å–æ –¥—É–ø–ª–∞ –≤—Ä–µ–¥–Ω–æ—Å—Ç.</p><div class="shop-price">150–¥</div></div>
            <div class="shop-item" onclick="buyItem('bribe', 500)"><div class="shop-icon">üïµÔ∏è</div><h3>–ò–Ω—Å–∞—ò–¥–µ—Ä</h3><p>–ó–µ–º–∏ –≥–æ —Å–ª–µ–¥–Ω–∏–æ—Ç –∏–º–æ—Ç –Ω–∞ –∫–æ—ò —ú–µ –∑–∞—Å—Ç–∞–Ω–µ—à –∑–∞ 1 –¥–µ–Ω–∞—Ä.</p><div class="shop-price">500–¥</div></div>
        </div>
        <button class="action-btn btn-pass" style="margin-top:20px; width:100%;" onclick="document.getElementById('shop-modal').style.display='none'">–ó–ê–¢–í–û–†–ò</button>
    </div>
</div>

<!-- NEW: Property Card Overlay -->
<div id="card-overlay" class="modal-overlay"></div>

<!-- Game Over -->
<div id="game-over-overlay">
    <div class="modal-mini" style="width:600px; display:block; position:relative; top:auto; left:auto; transform:none; animation:none;">
        <h2>üèÜ –ö–†–ê–à –ù–ê –ò–ì–†–ê–¢–ê</h2>
        <p id="report-text" style="text-align:left; line-height:1.6; font-size:0.9rem; max-height: 300px; overflow-y:auto;"></p>
        <div id="qrcode" style="margin:15px auto; display:flex; justify-content:center;"></div>
        <button onclick="clearSave(); location.reload()" style="padding:10px 20px; background:var(--primary-color); color:white; border:none; border-radius:8px; cursor:pointer; margin-top:10px;">–ù–û–í–ê –ò–ì–†–ê</button>
    </div>
</div>

<script src="script.js"></script>
</body>
</html>